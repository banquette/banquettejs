/*!
 * Banquette Storage v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../_virtual/_tslib.js"),t=require("@banquette/config/_cjs/prod/config/configuration.service"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/inject-lazy.decorator"),i=require("@banquette/dependency-injection/_cjs/prod/decorator/service.decorator"),o=require("@banquette/utils-misc/_cjs/prod/is-server"),n=require("@banquette/utils-type/_cjs/prod/is-undefined"),s=require("../constant.js"),a=function(a){function CookiesAdapter(e){var t=a.call(this)||this;return t.prefix=e.get("storage.cookieAdapter.prefix"),t}return e.__extends(CookiesAdapter,a),CookiesAdapter.prototype.isAvailable=function(){return!o.isServer()&&!n.isUndefined(document.cookie)},CookiesAdapter.prototype.getPriority=function(){return 0},CookiesAdapter.prototype.get=function(t,r){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.getSync(t,r)]}))}))},CookiesAdapter.prototype.getSync=function(e,t){var r=("; "+document.cookie).split("; "+this.prefix+e+"=");if(2===r.length)return this.decode(r.pop().split(";").shift());var i=this.getVirtual(e);return n.isUndefined(i)?n.isUndefined(t)?null:t:this.decode(i)},CookiesAdapter.prototype.set=function(t,r){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return this.setSync(t,r),[2]}))}))},CookiesAdapter.prototype.setSync=function(e,t){var r=this.getSync(e),i=new Date;i.setTime(i.getTime()+126144e6);var o="; expires="+i.toUTCString(),n=this.encode(t);document.cookie=(this.prefix?this.prefix:"")+e+"="+this.encode(t)+o+"; path=/",this.setVirtual(e,n),this.notifyKeyChange(e,t,r)},CookiesAdapter.prototype.remove=function(t){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return this.removeSync(t),[2]}))}))},CookiesAdapter.prototype.removeSync=function(e){var t=this.getSync(e);document.cookie=this.prefix+e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.markAsRemoved(e),this.notifyKeyChange(e,void 0,t)},CookiesAdapter.prototype.clear=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return this.clearSync(),[2]}))}))},CookiesAdapter.prototype.clearSync=function(){for(var e=0,t=this.keysSync();e<t.length;e++){var r=t[e];this.removeSync(r)}this.notifyClear()},CookiesAdapter.prototype.length=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.keysSync().length]}))}))},CookiesAdapter.prototype.lengthSync=function(){return this.keysSync().length},CookiesAdapter.prototype.keys=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,this.keysSync()]}))}))},CookiesAdapter.prototype.keysSync=function(){for(var e=[],t=document.cookie.split(";"),r=0;r<t.length;r++){var i=t[r].split("=")[0];""!==i&&this.getVirtual(i)&&e.push(i)}return e},CookiesAdapter=e.__decorate([i.Service(s.StorageAdapterTag),e.__param(0,r.InjectLazy((function(){return t.ConfigurationService}))),e.__metadata("design:paramtypes",[t.ConfigurationService])],CookiesAdapter)}(require("./abstract.adapter.js").AbstractAdapter);exports.CookiesAdapter=a;
