/*!
 * Banquette Storage v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@banquette/event/_cjs/prod/event-dispatcher"),r=require("@banquette/utils-type/_cjs/prod/ensure-number"),n=require("@banquette/utils-type/_cjs/prod/is-boolean"),i=require("@banquette/utils-type/_cjs/prod/is-number"),a=require("@banquette/utils-type/_cjs/prod/is-object"),s=require("@banquette/utils-type/_cjs/prod/is-undefined"),u=require("../constant.js"),o=require("../event/storage-clear.event.js"),l=require("../event/storage-key-change.event.js"),c=Symbol("undefined");!function(e){e[e.Json=0]="Json",e[e.Number=1]="Number",e[e.Boolean=2]="Boolean",e[e.String=3]="String",e[e.Null=4]="Null",e[e.Undefined=5]="Undefined"}(e||(e={}));var p=function(){function AbstractAdapter(){this.virtualValues={},this._eventDispatcher=null}return Object.defineProperty(AbstractAdapter.prototype,"eventDispatcher",{get:function(){return null===this._eventDispatcher&&(this._eventDispatcher=new t.EventDispatcher),this._eventDispatcher},enumerable:!1,configurable:!0}),AbstractAdapter.prototype.onChange=function(e){return this.eventDispatcher.subscribe(u.StorageEvents.Change,e)},AbstractAdapter.prototype.encode=function(t){return a.isObject(t)?e.Json+":"+JSON.stringify(t):i.isNumber(t)?e.Number+":"+t:n.isBoolean(t)?e.Boolean+":"+(t?1:0):null===t?e.Null+":":s.isUndefined(t)?e.Undefined+":":e.String+":"+t},AbstractAdapter.prototype.decode=function(t){if(null===t)return null;if(t.length<2||":"!==t[1])return t;var n=parseInt(t.substring(0,1),10);switch(t=t.substring(2),n){case e.String:return t;case e.Number:return r.ensureNumber(t);case e.Boolean:return"1"===t;case e.Json:return JSON.parse(t);case e.Null:return null}},AbstractAdapter.prototype.getVirtual=function(e){return e=e.trim(),this.virtualValues[e]===c?void 0:this.virtualValues[e]},AbstractAdapter.prototype.setVirtual=function(e,t){var r=this;e=e.trim(),this.virtualValues[e]=t,setTimeout((function(){delete r.virtualValues[e]}))},AbstractAdapter.prototype.markAsRemoved=function(e){var t=this;e=e.trim(),this.virtualValues[e]=c,setTimeout((function(){t.virtualValues[e]===c&&delete t.virtualValues[e]}))},AbstractAdapter.prototype.notifyKeyChange=function(e,t,r){this._eventDispatcher&&t!==r&&this._eventDispatcher.dispatch(u.StorageEvents.Change,new l.StorageKeyChangeEvent(e,t,r))},AbstractAdapter.prototype.notifyClear=function(){this._eventDispatcher&&this._eventDispatcher.dispatch(u.StorageEvents.Change,new o.StorageClearEvent)},AbstractAdapter}();exports.AbstractAdapter=p;
