/*!
 * Banquette Ui v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/api/_cjs/prod/api.service"),t=require("@banquette/api/_cjs/prod/exception/remote.exception"),n=require("@banquette/dependency-injection/_cjs/prod/injector"),i=require("@banquette/event/_cjs/prod/event-dispatcher"),s=require("@banquette/http/_cjs/prod/constants"),r=require("@banquette/utils-misc/_cjs/prod/are-equal"),o=require("@banquette/utils-object/_cjs/prod/extend"),u=require("@banquette/utils-string/_cjs/prod/is-non-empty-string"),l=require("@banquette/utils-type/_cjs/prod/is-object"),p=require("@banquette/utils-type/_cjs/prod/is-undefined"),a=require("./constant.js"),d=function(){function RemoteModule(){this.url=null,this.endpoint=null,this.method=s.HttpMethod.GET,this.model=null,this.allowMultiple=!1,this.response=null,this.api=n.Injector.Get(e.ApiService),this.eventDispatcher=new i.EventDispatcher}return Object.defineProperty(RemoteModule.prototype,"isApplicable",{get:function(){return null!==this.endpoint||null!==this.url},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteModule.prototype,"pending",{get:function(){return null!==this.response&&this.response.isPending},enumerable:!1,configurable:!0}),RemoteModule.prototype.updateConfiguration=function(e){for(var t=!1,n=0,i=["url","endpoint","method","model","urlParams","headers","payloadType","responseType","allowMultiple"];n<i.length;n++){var s=i[n],o=p.isUndefined(e[s])?this[s]:e[s];t||r.areEqual(this[s],o)||(t=!0),this[s]=o}t&&this.eventDispatcher.dispatchWithErrorHandling(a.RemoteModuleEvents.ConfigurationChange)},RemoteModule.prototype.send=function(e,n,i,s){return void 0===n&&(n={}),void 0===i&&(i={}),void 0===s&&(s=[]),null!==this.response&&this.response.isPending&&!this.allowMultiple&&this.response.request.cancel(),this.response=this.api.send(this.api.build().url(this.url).endpoint(this.endpoint).model(this.model).method(this.method).params(o.extend({},[this.urlParams,n])).headers(o.extend({},[this.headers,i])).payload(e,this.payloadType).responseType(this.responseType).tags(s).getRequest()),this.response.promise.catch((function(e){return!e.isError||e.result instanceof t.RemoteException||l.isObject(e.result)&&!p.isUndefined(e.result.exception)&&u.isNonEmptyString(e.result.exception.message)&&(e.result=new t.RemoteException(e.result.exception.type||"remote",e.result.exception.message)),e})),this.response},RemoteModule.prototype.onConfigurationChange=function(e){return this.eventDispatcher.subscribe(a.RemoteModuleEvents.ConfigurationChange,e)},RemoteModule}();exports.RemoteModule=d;
