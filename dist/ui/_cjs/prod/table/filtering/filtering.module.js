/*!
 * Banquette Ui v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/event/_cjs/prod/event-dispatcher"),t=require("@banquette/utils-misc/_cjs/prod/are-equal"),i=require("@banquette/utils-object/_cjs/prod/clone-deep"),n=require("@banquette/utils-object/_cjs/prod/extend"),r=require("@banquette/utils-object/_cjs/prod/flatten-object"),s=require("@banquette/utils-string/_cjs/prod/format/slugify"),l=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),o=require("@banquette/utils-type/_cjs/prod/is-object"),u=require("@banquette/utils-type/_cjs/prod/is-type"),a=require("./constant.js"),c=function(){function FilteringModule(){this.enabled=!0,this.changed=!0,this.remote="auto",this.filters={},this.lastNotifiedFilters={},this.eventDispatcher=new e.EventDispatcher}return Object.defineProperty(FilteringModule.prototype,"isApplicable",{get:function(){return Object.keys(this.getActiveFilters()).length>0},enumerable:!1,configurable:!0}),FilteringModule.prototype.apply=function(e){for(var t=this,i=r.flattenObject(this.getActiveFilters(),"."),_loop_1=function(n){e=e.filter((function(e){for(var r=n.split("."),s=e.item,l=0,u=r;l<u.length;l++){var a=u[l];if(!o.isObject(s)){s=void 0;break}s=s[a]}return t.matchFilter(i[n],s)}))},n=0,s=Object.keys(i);n<s.length;n++){_loop_1(s[n])}return this.changed=!1,e},FilteringModule.prototype.getActiveFilters=function(){var cloneAndFilter=function(e){for(var t={},i=0,n=Object.keys(e);i<n.length;i++){var r=n[i],s=e[r];if(u.isType(s,o.isObject)){var a=cloneAndFilter(s);null!==a&&Object.keys(a).length>0&&(t[r]=a)}else l.isNullOrUndefined(s)||""===s||(t[r]=s)}return t};return cloneAndFilter(this.filters)||{}},FilteringModule.prototype.setFilters=function(e){this.filters=i.cloneDeep(e),this.notifyChange()},FilteringModule.prototype.updateFilters=function(e){n.extend(this.filters,e,!0),this.notifyChange()},FilteringModule.prototype.setFilter=function(e,t){this.filters[e]=i.cloneDeep(t),this.notifyChange()},FilteringModule.prototype.removeFilter=function(e){delete this.filters[e],this.notifyChange()},FilteringModule.prototype.digestServerResponse=function(e){Object.assign(this.filters,e),this.changed=!1,this.eventDispatcher.dispatch(a.FilteringEvents.Invalidated)},FilteringModule.prototype.onChange=function(e){return this.eventDispatcher.subscribe(a.FilteringEvents.Changed,e)},FilteringModule.prototype.notifyChange=function(){var e=this.getActiveFilters();t.areEqual(e,this.lastNotifiedFilters)||(this.changed=!0,this.lastNotifiedFilters=e,this.eventDispatcher.dispatch(a.FilteringEvents.Changed))},FilteringModule.prototype.matchFilter=function(e,t){return s.slugify(String(t)).includes(s.slugify(String(e)))},FilteringModule}();exports.FilteringModule=c;
