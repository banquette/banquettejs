/*!
 * Banquette Ui v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../_virtual/_tslib.js"),e=require("@banquette/dependency-injection/_cjs/prod/decorator/module.decorator"),a=require("@banquette/event/_cjs/prod/event-dispatcher"),i=require("@banquette/utils-type/_cjs/prod/ensure-integer"),n=require("@banquette/utils-type/_cjs/prod/is-undefined"),s=require("@banquette/utils-type/_cjs/prod/is-valid-number"),r=require("./constant.js"),o=function(){function PaginationModule(){this.enabled=!0,this.changed=!0,this.remote="auto",this.position=r.PaginationPosition.Top,this.summary=!0,this._page=1,this._pageId=null,this._itemsPerPage=20,this.allowedItemsPerPage=[10,20,30,50,100],this.allowFirstPage=!0,this.allowLastPage=!0,this.allowPageInput=!0,this._strategy=r.PaginationStrategy.Offset,this.currentState={page:1,totalResultsPerPage:20,totalResultsCount:0,totalPagesCount:0,firstResultCount:0,lastResultCount:0,isFirstPage:!0,isLastPage:!0,navItems:[]},this.delta=3,this.previousPageId=null,this.nextPageId=null,this.eventDispatcher=new a.EventDispatcher}return Object.defineProperty(PaginationModule.prototype,"page",{get:function(){return this._page},set:function(t){this.strategy===r.PaginationStrategy.Offset&&this._page!==t&&(this._page=t,this.currentState.page=t,this.notifyChange())},enumerable:!1,configurable:!0}),Object.defineProperty(PaginationModule.prototype,"pageId",{get:function(){return this._pageId},set:function(t){this.strategy===r.PaginationStrategy.Id&&this._pageId!==t&&(this._pageId=t,this.notifyChange())},enumerable:!1,configurable:!0}),Object.defineProperty(PaginationModule.prototype,"itemsPerPage",{get:function(){return this._itemsPerPage},set:function(t){var e=this._itemsPerPage;this._itemsPerPage=this.allowedItemsPerPage.reduce((function(e,a){return Math.abs(a-t)<Math.abs(e-t)&&(e=a),e}),this.allowedItemsPerPage[0]),this._itemsPerPage!==e&&this.notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(PaginationModule.prototype,"strategy",{get:function(){return this._strategy},set:function(t){this._strategy!==t&&(this._strategy=t,this.notifyChange())},enumerable:!1,configurable:!0}),PaginationModule.prototype.previous=function(){this.currentState&&!this.currentState.isFirstPage&&(this.strategy===r.PaginationStrategy.Offset?this.goTo(this.currentState.page-1):null!==this.previousPageId&&this.goTo(this.previousPageId))},PaginationModule.prototype.next=function(){this.currentState&&!this.currentState.isLastPage&&(this.strategy===r.PaginationStrategy.Offset?this.goTo(this.currentState.page+1):null!==this.nextPageId&&this.goTo(this.nextPageId))},PaginationModule.prototype.goTo=function(t){this.strategy===r.PaginationStrategy.Offset?s.isValidNumber(t)&&(this.page=t):this.pageId=t},PaginationModule.prototype.export=function(){return{page:this.page,nextPageId:this.nextPageId,previousPageId:this.previousPageId,itemsPerPage:this.itemsPerPage}},PaginationModule.prototype.import=function(t){this.page=Math.min(1,i.ensureInteger(t.page)),this.nextPageId=t.nextPageId,this.previousPageId=t.previousPageId,this.itemsPerPage=i.ensureInteger(t.itemsPerPage)},PaginationModule.prototype.digestServerResponse=function(t){this.strategy===r.PaginationStrategy.Offset?this._page=Math.max(1,i.ensureInteger(t.page)):this.strategy===r.PaginationStrategy.Id&&(this._pageId=t.pageId||null,this.previousPageId=t.previousPageId||null,this.nextPageId=t.nextPageId||null),n.isUndefined(t.itemsPerPage)||(this._itemsPerPage=t.itemsPerPage),this.updateCurrentState(t.total),this._page=this.currentState.page,this.eventDispatcher.dispatch(r.PaginationEvents.Invalidated),this.changed=!1},PaginationModule.prototype.digestFullItemsList=function(t){return this.updateCurrentState(t.length),this.changed=!1,this.sliceItemsForCurrentPage(t)},PaginationModule.prototype.sliceItemsForCurrentPage=function(t){var e=(this.currentState.page-1)*this.itemsPerPage;return t.slice(e,e+this.itemsPerPage)},PaginationModule.prototype.onChange=function(t){return this.eventDispatcher.subscribe(r.PaginationEvents.Changed,t)},PaginationModule.prototype.onInvalidate=function(t){return this.eventDispatcher.subscribe(r.PaginationEvents.Invalidated,t)},PaginationModule.prototype.updateCurrentState=function(t){this.currentState.totalPagesCount=Math.ceil(t/this.itemsPerPage),this.currentState.page=Math.max(1,Math.min(this.currentState.totalPagesCount,this._page)),this.currentState.isFirstPage=1===this.currentState.page,this.currentState.isLastPage=Math.min(this.currentState.page,this.currentState.totalPagesCount)===this.currentState.totalPagesCount,this.currentState.totalResultsCount=t,this.currentState.totalResultsPerPage=this.itemsPerPage,this.currentState.firstResultCount=Math.min(this.itemsPerPage*(this.currentState.page-1)+1,t);var e=this.itemsPerPage;this.currentState.isLastPage&&(e=this.itemsPerPage-t%this.itemsPerPage),this.currentState.lastResultCount=Math.min(t,this.currentState.firstResultCount+e-1),this.updateNavigationItems()},PaginationModule.prototype.updateNavigationItems=function(){if(this.currentState.navItems=[],this.strategy===r.PaginationStrategy.Offset)for(var t=this.currentState.totalPagesCount>2*this.delta+1,e=Math.max(1,this.currentState.page-this.delta),a=Math.min(this.currentState.totalPagesCount,this.currentState.page+this.delta),i=e;i<=a&&i<=this.currentState.totalPagesCount;++i){var n={page:i,text:String(i),current:i===this.currentState.page,type:i===this.currentState.page&&this.allowPageInput&&t?"input":"link"};this.currentState.navItems.push(n)}},PaginationModule.prototype.notifyChange=function(){this.changed=!0,this.eventDispatcher.dispatch(r.PaginationEvents.Changed)},PaginationModule=t.__decorate([e.Module()],PaginationModule)}();exports.PaginationModule=o;
