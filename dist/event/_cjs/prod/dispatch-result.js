/*!
 * Banquette Event v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,s=require("./_virtual/_tslib.js"),e=require("@banquette/exception/_cjs/prod/exception.factory"),i=require("@banquette/utils-type/_cjs/prod/is-promise-like");exports.DispatchResultStatus=void 0,(t=exports.DispatchResultStatus||(exports.DispatchResultStatus={}))[t.Waiting=0]="Waiting",t[t.Error=1]="Error",t[t.Ready=2]="Ready";var r=function(){function DispatchResult(t){void 0===t&&(t=null),this.parent=t,this.defaultPrevented=!1,this.results=[],this.promise=null,this.localPromise=null,this.previousPromise=null,this.promiseResolve=null,this.errorDetail=null,this.setStatus(exports.DispatchResultStatus.Ready)}return DispatchResult.prototype.registerCall=function(t){i.isPromiseLike(t.result)?this.delayResponse(t.result):this.addResult(t.result)},DispatchResult.prototype.addResult=function(t){return this.status!==exports.DispatchResultStatus.Error&&(this.results.push(t),!0)},DispatchResult.prototype.onReady=function(){return s.__awaiter(this,void 0,void 0,(function(){return s.__generator(this,(function(t){switch(t.label){case 0:return null===this.promise?[3,2]:[4,this.promise];case 1:return t.sent(),[2,this];case 2:return[2,this]}}))}))},DispatchResult.prototype.preventDefault=function(){this.defaultPrevented=!0,this.parent&&this.parent.preventDefault()},DispatchResult.prototype.delayResponse=function(t){var s=this;this.setStatus(exports.DispatchResultStatus.Waiting),null===this.promise&&(this.promise=new Promise((function(t){s.promiseResolve=t})).then((function(){return s.status===exports.DispatchResultStatus.Waiting&&s.setStatus(exports.DispatchResultStatus.Ready),s.promiseResolve=null,s.cleanupAsync(),s})).catch((function(t){return s.fail(t),s})));var e=(null===this.localPromise?t:Promise.all([this.localPromise,t])).then((function(){return setTimeout((function(){e===s.previousPromise&&s.promiseResolve&&s.promiseResolve&&s.promiseResolve(s),s.localPromise=null})),s})).catch((function(t){s.fail(t)}));this.localPromise=e,this.previousPromise=e},DispatchResult.prototype.fail=function(t){this.errorDetail=e.ExceptionFactory.EnsureException(t),this.results.splice(0,this.results.length),this.setStatus(exports.DispatchResultStatus.Error),null!==this.promiseResolve&&this.promiseResolve(this),this.cleanupAsync(),null!==this.parent&&this.parent.fail(t)},DispatchResult.prototype.setStatus=function(t){this.status=t,this.ready=this.status===exports.DispatchResultStatus.Ready,this.error=this.status===exports.DispatchResultStatus.Error,this.waiting=this.status===exports.DispatchResultStatus.Waiting},DispatchResult.prototype.cleanupAsync=function(){this.promiseResolve=null,this.promise=null},DispatchResult}();exports.DispatchResult=r;
