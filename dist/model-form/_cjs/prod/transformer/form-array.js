/*!
 * Banquette ModelForm v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@banquette/dependency-injection/_cjs/prod/injector"),e=require("@banquette/form/_cjs/prod/form-array"),t=require("@banquette/model/_cjs/prod/transformer/transform-context"),n=require("@banquette/model/_cjs/prod/transformer/transform-pipeline"),o=require("@banquette/model/_cjs/prod/utils"),u=require("@banquette/utils-type/_cjs/prod/is-array"),a=require("@banquette/utils-type/_cjs/prod/is-undefined"),s=require("../contants.js"),i=require("../form-component.factory.js"),l=require("./form-control.js"),f=r.Injector.Get(i.FormComponentFactory);exports.FormArray=function FormArray(r){void 0===r&&(r=l.FormControl()),(a.isUndefined(r.type)||s.FormRelatedTransformers.indexOf(r.type)<0)&&(r=l.FormControl(r));var i=o.ensureCompleteTransformer(r);return{type:s.FormArrayTransformerSymbol,getChild:function(){return i},transform:function(r){if(!u.isArray(r.value)){var e=f.createFormArray(r.ctor,r.property);return r.result.setResult(e),r.result}for(var o={},a={},s=0;s<r.value.length;++s)a[s+""]=i;var l=new n.TransformPipeline(r.result,a);return l.forEach((function(e,n){var o=new t.TransformContext(r,r.type,r.ctor,r.value[parseInt(e,10)],e);return n.transform(o)}),(function(r,e){o[r]=e.result})),l.onFinish((function(){for(var e=f.createFormArray(r.ctor,r.property),t=0,n=Object.keys(o).sort();t<n.length;t++){var u=n[t];e.append(o[u])}r.result.setResult(e)})),r.result},transformInverse:function(r){if(!(r.value instanceof e.FormArray))return r.result.setResult([]),r.result;for(var o={},u=0;u<r.value.length;++u)o[u+""]=i;var a={},s=new n.TransformPipeline(r.result,o);return s.forEach((function(e,n){var o=new t.TransformContext(r,r.type,r.ctor,r.value.get(parseInt(e,10)),e);return n.transformInverse(o)}),(function(r,e){a[r]=e.result})),s.onFinish((function(){for(var e=[],t=0,n=Object.keys(a).sort();t<n.length;t++){var o=n[t];e.push(a[o])}r.result.setResult(e)})),r.result}}};
