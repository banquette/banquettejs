/*!
 * Banquette ModelForm v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../_virtual/_tslib.js"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/module.decorator"),o=require("@banquette/exception/_cjs/prod/usage.exception"),a=require("@banquette/form/_cjs/prod/form-object"),n=require("@banquette/model/_cjs/prod/constants"),s=require("@banquette/model/_cjs/prod/model-metadata.service"),m=require("@banquette/model/_cjs/prod/model-transform-metadata.service"),c=require("@banquette/model/_cjs/prod/model.factory.service"),u=require("@banquette/model/_cjs/prod/transformer/transform-context"),i=require("@banquette/model/_cjs/prod/transformer/type/root/abstract-root-transformer"),f=require("@banquette/utils-type/_cjs/prod/is-object"),l=require("../../form-component.factory.js"),d=Symbol("form-component"),p=function(i){function FormTransformer(e,r,t,o){var a=i.call(this,e,r,t)||this;return a.modelMetadata=e,a.transformMetadata=r,a.modelFactory=t,a.formFactory=o,a}return e.__extends(FormTransformer,i),FormTransformer.prototype.getTransformerSymbol=function(){return d},FormTransformer.prototype.doTransform=function(e,r){var t=this.formFactory.createFormObject(e.ctor,e.property);return r.forEach((function(r,t){var o=new u.TransformContext(e,e.type,e.ctor,e.value[r],r);return t.transform(o)}),(function(e,r){f.isObject(r.result)&&t.set(e,r.result)})),r.onFinish((function(){e.result.setResult(t)})),e.result},FormTransformer.prototype.doTransformInverse=function(e,r,t){if(!(e.value instanceof a.FormObject))throw new o.UsageException("Invalid input value for inverse transform. Expecting a FormObject.");return t.forEach((function(r,t){if(!(e.value instanceof a.FormObject&&e.value.has(r)))return e.result.setResult(null),e.result;var o=new u.TransformContext(e,e.type,e.ctor,e.value.get(r),r);return t.transformInverse(o)}),(function(e,t){r[e]=t.result})),t.onFinish((function(){e.result.setResult(r)})),e.result},FormTransformer=e.__decorate([t.Module(n.ModelTransformerTag),e.__param(0,r.Inject(s.ModelMetadataService)),e.__param(1,r.Inject(m.ModelTransformMetadataService)),e.__param(2,r.Inject(c.ModelFactoryService)),e.__param(3,r.Inject(l.FormComponentFactory)),e.__metadata("design:paramtypes",[s.ModelMetadataService,m.ModelTransformMetadataService,c.ModelFactoryService,l.FormComponentFactory])],FormTransformer)}(i.AbstractRootTransformer);exports.FormTransformer=p,exports.FormTransformerSymbol=d;
