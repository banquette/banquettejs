/*!
 * Banquette UtilsString v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@banquette/exception/_cjs/prod/usage.exception"),e=require("@banquette/utils-type/_cjs/prod/is-string"),n="",t=0,a=[],s=0;function readLength(){var r=n.indexOf(":",t),e=n.substring(t,r);return t=r+2,parseInt(e,10)}function readInt(){var r=n.indexOf(";",t),e=n.substring(t,r);return t=r+1,parseInt(e,10)}function readString(r){void 0===r&&(r='"');for(var e,a,s=readLength(),i=0,u=0;u<s;)(e=n.charCodeAt(t+i++))<=127?u++:u+=e>2047?3:2;return n.charAt(t+i)!==r&&(i+=n.indexOf('"',t+i)-t-i),a=n.substring(t,t+i),t+=i+2,a}function readType(){var r=n.charAt(t);return t+=2,r}function readKey(){var e=readType();switch(e){case"i":return readInt();case"s":return readString()}throw new r.UsageException('Unknown key type "'.concat(e,'" at position ').concat(t-2))}function parseNext(){var e=readType();switch(e){case"i":return function parseAsInt(){var r=readInt();return a[s++]=r,r}();case"d":return function parseAsFloat(){var r=n.indexOf(";",t),e=parseFloat(n.substring(t,r));return t=r+1,a[s++]=e,e}();case"b":return function parseAsBoolean(){var r=n.indexOf(";",t),e="1"===n.substring(t,r);return t=r+1,a[s++]=e,e}();case"s":return function parseAsString(){var r=readString();return a[s++]=r,r}();case"a":return function parseAsArray(){var r,e,n,i,u,c=readLength(),o=[],p={},f=o,d=s++;for(a[d]=f,n=0;n<c;n++)if(r=readKey(),e=parseNext(),f===o&&r+""==n+"")o.push(e);else{if(f!==p){for(i=0,u=o.length;i<u;i++)p[i]=o[i];f=p,a[d]=f}p[r]=e}return t++,f}();case"O":return function parseAsObject(){var r,e,n,i,u={},c=s++,o=readString();for(a[c]=u,r=readLength(),i=0;i<r;i++)e=fixPropertyName(String(readKey()),o),n=parseNext(),u[e]=n;return t++,u}();case"C":return function parseAsCustom(){var r=readString(),e=readString("}");return t--,{__PHP_Incomplete_Class_Name:r,serialized:e}}();case"r":return function parseAsRefValue(){var r=readInt(),e=a[r-1];return a[s++]=e,e}();case"R":return function parseAsRef(){var r=readInt();return a[r-1]}();case"N":return function parseAsNull(){return a[s++]=null,null}()}throw new r.UsageException('Unknown type "'.concat(e,'" at position ').concat(t-2))}function fixPropertyName(n,a){var s,i,u;if(e.isString(n)&&"\0"===n.charAt(0)){if((u=n.indexOf("\0",1))>0)return s=n.substring(1,u),i=n.substring(u+1),"*"===s||a===s?i:s+"::"+i;throw new r.UsageException('Expected two <NUL> characters in non-public property "'.concat(n,'" at position ').concat(t-n.length-2))}return n}exports.phpUnserialize=function phpUnserialize(r){return n=r,a=[],t=0,s=0,parseNext()};
