/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/dependency-injection/_cjs/prod/injector"),r=require("@banquette/exception/_cjs/prod/usage.exception"),t=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),n=require("../../model-metadata.service.js"),o=require("../transform-context.js"),a=require("../transform.service.js"),i=e.Injector.Get(n.ModelMetadataService);function createSubContext(e,r){var t=i.resolveAlias(r);return new o.TransformContext(e,e.type,t,e.value,e.property)}exports.Model=function Model(){var getIdentifier=function(e){if(!(e=e.getHighestContextWithProperty()).property)throw new r.UsageException('Unable to resolve the relation. The "Model" transformer can only be applied on properties.');var t=i.getRelation(e.ctor,e.property);if(null===t)throw new r.UsageException('No relation has been defined for "'.concat(e.ctor.name,"::").concat(e.property,'".\n                Please define a "@Relation()" decorator on "').concat(e.property,'".'));return t};return{transform:function(r){return t.isNullOrUndefined(r.value)?(r.result.setResult(null),r.result):e.Injector.Get(a.TransformService).transform(createSubContext(r,getIdentifier(r)))},transformInverse:function(r){return t.isNullOrUndefined(r.value)?(r.result.setResult(null),r.result):e.Injector.Get(a.TransformService).transformInverse(createSubContext(r,getIdentifier(r)))}}};
