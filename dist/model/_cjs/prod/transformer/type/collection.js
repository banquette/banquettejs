/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/dependency-injection/_cjs/prod/injector"),r=require("@banquette/utils-type/_cjs/prod/is-array"),t=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),n=require("@banquette/utils-type/_cjs/prod/is-undefined"),u=require("../../model-metadata.service.js"),i=require("../../utils.js"),s=require("../transform-context.js"),o=require("../transform-pipeline.js"),l=require("./model.js"),a=require("./raw.js"),f=null;exports.Collection=function Collection(c){var apply=function(d,p){n.isUndefined(c)&&(null===f&&(f=e.Injector.Get(u.ModelMetadataService)),p=p.getHighestContextWithProperty(),c=null!==p.property&&f.getRelation(p.ctor,p.property)?l.Model():a.Raw());var v=i.ensureCompleteTransformer(c);if(r.isArray(p.value)){for(var q={},m={},y=0;y<p.value.length;++y)m[y+""]=v;var j=new o.TransformPipeline(p.result,m);j.forEach((function(e,r){var t=new s.TransformContext(p,p.type,p.ctor,p.value[e],e);return r[d](t)}),(function(e,r){q[e]=r.result})),j.onFinish((function(){for(var e=[],r=0;r<p.value.length;++r)e.push(q[r+""]);p.result.setResult(e)}))}else p.result.setResult(t.isNullOrUndefined(p.value)?p.value:[])};return{transform:function(e){return apply("transform",e),e.result},transformInverse:function(e){return apply("transformInverse",e),e.result}}};
