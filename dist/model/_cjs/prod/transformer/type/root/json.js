/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../_virtual/_tslib.js"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/module.decorator"),t=require("@banquette/exception/_cjs/prod/exception.factory"),n=require("@banquette/exception/_cjs/prod/usage.exception"),o=require("@banquette/utils-type/_cjs/prod/is-object"),s=require("@banquette/utils-type/_cjs/prod/is-string"),i=require("../../../constants.js"),u=require("../../../exception/invalid-json.exception.js"),a=require("../../transform-context.js"),c=require("./abstract-root-transformer.js"),f=Symbol("json"),l=function(c){function JsonTransformer(){return null!==c&&c.apply(this,arguments)||this}return e.__extends(JsonTransformer,c),JsonTransformer.prototype.getTransformerSymbol=function(){return f},JsonTransformer.prototype.doTransform=function(e,r){var t={};return r.forEach((function(r,t){var n=new a.TransformContext(e,e.type,e.ctor,e.value[r],r);return t.transform(n)}),(function(e,r){t[e]=r.result})),r.onFinish((function(){null===e.parent?e.result.setResult(JSON.stringify(t)):e.result.setResult(t)})),e.result},JsonTransformer.prototype.doTransformInverse=function(e,r,t){if(null===e.parent&&!s.isString(e.value))throw new n.UsageException("Invalid input value for inverse transform. Expecting a string.");var o=this.decodeValue(e);return t.forEach((function(r,t){var n=new a.TransformContext(e,e.type,e.ctor,o[r],r);return t.transformInverse(n)}),(function(e,t){r[e]=t.result})),t.onFinish((function(){e.result.setResult(r)})),e.result},JsonTransformer.prototype.decodeValue=function(e){if(null!==e.parent)return e.value;try{var r=JSON.parse(e.value);if(o.isObject(r))return r}catch(e){throw new u.InvalidJsonException("Failed to decode JSON string.",t.ExceptionFactory.EnsureException(e))}throw new u.InvalidJsonException("JSON string didn't output an object.")},JsonTransformer=e.__decorate([r.Module(i.ModelTransformerTag)],JsonTransformer)}(c.AbstractRootTransformer);exports.JsonTransformer=l,exports.JsonTransformerSymbol=f;
