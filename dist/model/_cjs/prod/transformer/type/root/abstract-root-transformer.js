/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../_virtual/_tslib.js"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),t=require("@banquette/exception/_cjs/prod/exception.factory"),o=require("@banquette/exception/_cjs/prod/usage.exception"),a=require("@banquette/utils-object/_cjs/prod/get-symbol-description"),n=require("@banquette/utils-type/_cjs/prod/is-compound"),i=require("@banquette/utils-type/_cjs/prod/is-object"),s=require("@banquette/utils-type/_cjs/prod/is-scalar"),c=require("../../../model-metadata.service.js"),u=require("../../../model-transform-metadata.service.js"),m=require("../../../model.factory.service.js"),l=require("../../transform-pipeline.js"),f=require("../../../utils.js"),p=function(){function AbstractRootTransformer(e,r,t){this.modelMetadata=e,this.transformMetadata=r,this.modelFactory=t}return AbstractRootTransformer.prototype.supports=function(e){return e.type===this.getTransformerSymbol()},AbstractRootTransformer.prototype.transform=function(e){var r,n;try{n=this.getTransformableProperties(e),r=new l.TransformPipeline(e.result,n)}catch(r){throw new o.UsageException("Transform initialization failed for ".concat(e.ctor.name,"\n                (transformer: ").concat(a.getSymbolDescription(e.type)),t.ExceptionFactory.EnsureException(r))}return this.doTransform(e,r)},AbstractRootTransformer.prototype.transformInverse=function(e){var r,n;try{r=this.modelFactory.create(e.ctor,e),n=new l.TransformPipeline(e.result,this.getTransformableProperties(e))}catch(r){throw new o.UsageException("Transform inverse initialization failed for ".concat(e.ctor.name,"\n                (transformer: ").concat(a.getSymbolDescription(e.type)),t.ExceptionFactory.EnsureException(r))}return this.doTransformInverse(e,r,n)},AbstractRootTransformer.prototype.getTransformableProperties=function(e){if(e.ctor===Object&&i.isObject(e.value)){var r=this.transformMetadata.getWildcard(e.ctor,this.getTransformerSymbol());if(null===r)return{};var t=f.ensureCompleteTransformer(r);return Object.keys(e.value).filter((function(r){var t=e.value[r];return s.isScalar(t)||n.isCompound(t)})).reduce((function(e,r){return e[r]=t,e}),{})}return this.transformMetadata.getAll(e.ctor,this.getTransformerSymbol())},AbstractRootTransformer=e.__decorate([e.__param(0,r.Inject(c.ModelMetadataService)),e.__param(1,r.Inject(u.ModelTransformMetadataService)),e.__param(2,r.Inject(m.ModelFactoryService)),e.__metadata("design:paramtypes",[c.ModelMetadataService,u.ModelTransformMetadataService,m.ModelFactoryService])],AbstractRootTransformer)}();exports.AbstractRootTransformer=p;
