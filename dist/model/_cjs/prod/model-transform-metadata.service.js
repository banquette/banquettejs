/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/service.decorator"),a=require("@banquette/exception/_cjs/prod/usage.exception"),i=require("@banquette/utils-object/_cjs/prod/get-symbol-description"),o=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),n=require("@banquette/utils-type/_cjs/prod/is-undefined"),s=require("./constants.js"),d=require("./model-metadata.service.js"),l=require("./utils.js"),c=function(){function ModelTransformMetadataService(e){this.modelMetadata=e,this.transformersMap=new WeakMap}return ModelTransformMetadataService.prototype.getAll=function(e,t){var r={},a=this.modelMetadata.resolveAlias(e);do{var i=this.transformersMap.get(a);o.isNullOrUndefined(i)||n.isUndefined(i[t])||(r=Object.assign({},i[t],r)),a=Object.getPrototypeOf(a)}while(a&&a!==s.ObjectCtor);return r},ModelTransformMetadataService.prototype.getWildcard=function(e,t){var r=this.modelMetadata.resolveAlias(e),a=this.transformersMap.get(r);return o.isNullOrUndefined(a)||n.isUndefined(a[t])?null:a[t][s.Wildcard]||null},ModelTransformMetadataService.prototype.register=function(e,t,r,d){var c=this.modelMetadata.resolveAlias(e),f=this.transformersMap.get(c);o.isNullOrUndefined(f)&&(f={}),n.isUndefined(f[t])&&(f[t]={});var u=f[t];if(!n.isUndefined(u[r])&&r!==s.Wildcard)throw new a.UsageException('Another transformer for "'.concat(i.getSymbolDescription(t),'" is already registered for "').concat(c.name,"::").concat(r,'".\n                Please call "replace()" instead if you want to override it.'));u[r]=l.ensureCompleteTransformer(d),this.transformersMap.set(c,f)},ModelTransformMetadataService.prototype.registerWildcard=function(e,t,r){this.register(e,t,s.Wildcard,r)},ModelTransformMetadataService.prototype.replace=function(e,t,r,a){var i=this.modelMetadata.resolveAlias(e);this.remove(i,t,r),this.register(i,t,r,a)},ModelTransformMetadataService.prototype.remove=function(e,t,r){var a=this.modelMetadata.resolveAlias(e),i=this.transformersMap.get(a);o.isNullOrUndefined(i)||n.isUndefined(i[t])||(delete i[t][r],this.transformersMap.set(a,i))},ModelTransformMetadataService.prototype.removeWildcard=function(e,t){this.remove(e,t,s.Wildcard)},ModelTransformMetadataService.prototype.get=function(e,t,r){var a=this.modelMetadata.resolveAlias(e),i=this.transformersMap.get(a);return o.isNullOrUndefined(i)||n.isUndefined(i[t])?null:i[t][r]||this.getWildcard(a,t)},ModelTransformMetadataService.prototype.has=function(e,t,r){return null!==this.get(e,t,r)},ModelTransformMetadataService.prototype.clear=function(){this.transformersMap=new WeakMap},ModelTransformMetadataService=e.__decorate([r.Service(),e.__param(0,t.Inject(d.ModelMetadataService)),e.__metadata("design:paramtypes",[d.ModelMetadataService])],ModelTransformMetadataService)}();exports.ModelTransformMetadataService=c;
