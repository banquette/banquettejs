/*!
 * Banquette Model v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,s=require("./_virtual/_tslib.js"),e=require("@banquette/exception/_cjs/prod/exception.factory"),r=require("@banquette/utils-misc/_cjs/prod/proxy");exports.TransformResultStatus=void 0,(t=exports.TransformResultStatus||(exports.TransformResultStatus={}))[t.Waiting=0]="Waiting",t[t.Error=1]="Error",t[t.Ready=2]="Ready";var i=function(){function TransformResult(t){void 0===t&&(t=null),this.parent=t,this.promise=null,this.localPromise=null,this.previousPromise=null,this.promiseResolve=null,this.promiseReject=null,this.errorDetail=null,this.setStatus(exports.TransformResultStatus.Ready)}return TransformResult.prototype.setResult=function(t){return this.status!==exports.TransformResultStatus.Error&&(this.result=t,!0)},TransformResult.prototype.delayResponse=function(t){var s=this;null===this.promise&&(this.promise=new Promise((function(t,e){s.promiseResolve=t,s.promiseReject=e})).then((function(){return s.setStatus(exports.TransformResultStatus.Ready),s.promiseResolve=s.promiseReject=null,s.cleanupAsync(),s})),this.promise.catch((function(t){return s.fail(t),s})));var e=null===this.localPromise?t:Promise.all([this.localPromise,t]);this.localPromise=e,this.previousPromise=e,this.parent&&this.parent.delayResponse(this.promise),this.setStatus(exports.TransformResultStatus.Waiting),e.then((function(){return e===s.previousPromise&&s.promiseResolve(s),s.localPromise=null,s})).catch(r.proxy(this.promiseReject,this))},TransformResult.prototype.onReady=function(){return s.__awaiter(this,void 0,void 0,(function(){return s.__generator(this,(function(t){switch(t.label){case 0:return null===this.promise?[3,2]:[4,this.promise];case 1:return t.sent(),[2,this];case 2:return[2,this]}}))}))},TransformResult.prototype.fail=function(t){this.errorDetail=e.ExceptionFactory.EnsureException(t),this.result=void 0,this.setStatus(exports.TransformResultStatus.Error),null!==this.promiseReject&&this.promiseReject(t),this.cleanupAsync(),null!==this.parent&&this.parent.fail(t)},TransformResult.prototype.setStatus=function(t){this.status=t,this.ready=this.status===exports.TransformResultStatus.Ready,this.error=this.status===exports.TransformResultStatus.Error,this.waiting=this.status===exports.TransformResultStatus.Waiting},TransformResult.prototype.cleanupAsync=function(){this.promiseResolve=null,this.promiseReject=null,this.promise=null},TransformResult}();exports.TransformResult=i;
