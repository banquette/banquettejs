/*!
 * Banquette Form v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/exception/_cjs/prod/usage.exception"),r=require("@banquette/utils-object/_cjs/prod/get-object-keys"),n=require("@banquette/utils-type/_cjs/prod/ensure-integer"),o=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),i=require("@banquette/utils-type/_cjs/prod/is-numeric"),a=require("@banquette/utils-type/_cjs/prod/is-undefined"),d=require("./abstract-form-group.js"),l=require("./constant.js"),u=require("./event/component-added.form-event.js"),c=require("./event/component-removed.form-event.js"),h=require("./event/value-changed.form-event.js"),s=require("./exception/component-not-found.exception.js"),p=function(d){function FormArray(e,t){void 0===e&&(e=[]);var r=d.call(this)||this;r.children_=[],r.additionalPatternTags.push("array");for(var n=0,o=e;n<o.length;n++){var i=o[n];r.append(i)}return r.setValidator(t||null),r}return e.__extends(FormArray,d),Object.defineProperty(FormArray.prototype,"children",{get:function(){return this.children_.reduce((function(e,t){return e.push(t.decorated),e}),[])},enumerable:!1,configurable:!0}),FormArray.prototype.append=function(e){var t=this;this.removeByRef(e),this.updateCollection((function(){t.children_.push(e.setParent(t.buildParentComponentDecorator())),t.children_[t.children_.length-1].propagateStatesToParent();var r=t.children_[t.children_.length-1].decorated.validator;null!==r&&t.updateContainerValidator((function(e){e.set(String(t.children_.length-1),r)}))})),this.dispatch(l.FormEvents.ComponentAdded,(function(){var e=t.children_.length-1;return new u.ComponentAddedFormEvent(t,t.children_[e].decorated,e)}))},FormArray.prototype.prepend=function(e){var t=this;this.removeByRef(e),this.updateCollection((function(){t.children_.unshift(e.setParent(t.buildParentComponentDecorator())),t.children_[0].propagateStatesToParent(),t.updateValidator()})),this.dispatch(l.FormEvents.ComponentAdded,(function(){return new u.ComponentAddedFormEvent(t,t.children_[0].decorated,0)}))},FormArray.prototype.insert=function(e,t){var r=this,n=this.getIndexOf(t);if(null!==n){if(n===e)return;this.remove(n)}this.updateCollection((function(){var n=t.setParent(r.buildParentComponentDecorator());(e=Math.min(e,r.children_.length))<r.children_.length?r.children_.splice(e,0,n):r.children_.push(n),n.propagateStatesToParent(),r.updateValidator()})),this.dispatch(l.FormEvents.ComponentAdded,(function(){return new u.ComponentAddedFormEvent(r,r.children_[0].decorated,0)}))},FormArray.prototype.get=function(e){if(!i.isNumeric(e))return this.getByPath(e);if(e=n.ensureInteger(e),!this.has(e))throw new s.ComponentNotFoundException(e,'No component named "'.concat(e,'" is currently present in "').concat(this.path,'".'));return this.children_[e].decorated},FormArray.prototype.getNameOf=function(e){for(var t=0;t<this.children_.length;++t)if(this.children_[t].decorated.id===e.id)return t;return null},FormArray.prototype.set=function(e,r){var n=this;if(e<this.children_.length){if(this.children_[e].decorated.id===r.id)return;this.remove(e)}this.updateCollection((function(){var o=r.setParent(n.buildParentComponentDecorator());if(e<n.children_.length)n.children_[e]=o,n.updateValidator();else{if(e!==n.children_.length)throw new t.UsageException('There is no component at index "'.concat(e,'" and index "').concat(e,'" is not the next contiguous identifier.'));n.children_.push(o);var i=n.children_[n.children_.length-1].decorated.validator;null!==i&&n.updateContainerValidator((function(e){e.set(String(n.children_.length-1),i)}))}o.propagateStatesToParent()})),this.dispatch(l.FormEvents.ComponentAdded,(function(){return new u.ComponentAddedFormEvent(n,n.children_[e].decorated,e)}))},FormArray.prototype.merge=function(e){var t=this;e.forEachDecorated((function(e){t.append(e.decorated)}))},FormArray.prototype.remove=function(e){var t=this;if(e>=this.children_.length)return null;var r=this.children_[e];return this.updateCollection((function(){r.removeStatesFromParent(),t.children_.splice(e,1),r.unsetParent(),t.updateValidator()})),this.dispatch(l.FormEvents.ComponentRemoved,(function(){return new c.ComponentRemovedFormEvent(t,r.decorated,e)})),r.decorated},FormArray.prototype.clear=function(){var e=this,t=[].concat(this.children_);this.updateCollection((function(){e.children_=[],e.updateValidator()}));for(var _loop_1=function(n){r.dispatch(l.FormEvents.ComponentRemoved,(function(){return new c.ComponentRemovedFormEvent(e,t[n].decorated,n)}))},r=this,n=0;n<t.length;++n)_loop_1(n)},FormArray.prototype.has=function(e){return e<this.children_.length},FormArray.prototype.count=function(){return this.children_.length},FormArray.prototype.setValue=function(e){for(var t=0,r=Math.min(this.children_.length,e.length);t<r;++t)o.isNullOrUndefined(e[t])||this.children_[t].setValue(e[t]);this.updateValue(),null===this.parent||this.hasContext(l.CallContext.Parent)||this.parent.updateValue()},FormArray.prototype.setDefaultValue=function(e){for(var t=0,r=Math.min(this.children_.length,e.length);t<r;++t)o.isNullOrUndefined(e[t])||this.children_[t].setDefaultValue(e[t]);this.updateValue(),null===this.parent||this.hasContext(l.CallContext.Parent)||this.parent.updateValue()},FormArray.prototype.forEach=function(t,n){a.isUndefined(n)&&(n=this.foreachFilters[l.FilterGroup.External]);var o=e.__spreadArray([],this.children_,!0),i=r.getObjectKeys(n);e:for(var d=0;d<o.length;++d){for(var u=0,c=i;u<c.length;u++){var h=c[u];if(o[d].decorated[h]!==n[h])continue e}if(!1===t(o[d].decorated,d))break}},FormArray.prototype.forEachDecorated=function(t){for(var r=e.__spreadArray([],this.children_,!0),n=0;n<r.length&&!1!==t(r[n],n);++n);},FormArray.prototype.updateValue=function(){this.doUpdateValue(null)},FormArray.prototype.doUpdateValue=function(e){var t=this;null===e&&(e=this.cloneValue()),this.value=[],this.forEach((function(e){t.value.push(e.value)}),this.foreachFilters[l.FilterGroup.UpdateValue]),this.dispatch(l.FormEvents.ValueChanged,(function(){return new h.ValueChangedFormEvent(t,e,t.value)})),null===this.parent||this.hasContext(l.CallContext.Parent)||this.parent.updateValue(),this.validateSelfIfStrategyMatches(l.ValidationStrategy.OnChange)},FormArray.prototype.updateCollection=function(e){var t=this.cloneValue();e(),this.doUpdateValue(t)},FormArray.prototype.cloneValue=function(){return[].concat(this.value)},FormArray}(d.AbstractFormGroup);exports.FormArray=p;
