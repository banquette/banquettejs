/*!
 * Banquette Form v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/exception/_cjs/prod/usage.exception"),n=require("@banquette/utils-object/_cjs/prod/get-object-keys"),r=require("@banquette/utils-string/_cjs/prod/format/ltrim"),o=require("@banquette/utils-string/_cjs/prod/format/trim"),i=require("@banquette/utils-type/_cjs/prod/is-undefined"),a=require("./abstract-form-group.js"),c=require("./constant.js"),s=require("./event/component-added.form-event.js"),d=require("./event/component-removed.form-event.js"),u=require("./event/value-changed.form-event.js"),l=require("./exception/component-not-found.exception.js"),h=function(a){function FormObject(e,t){void 0===e&&(e={});var n=a.call(this)||this;n.children_={},n.additionalPatternTags.push("object");for(var r=0,o=Object.keys(e);r<o.length;r++){var i=o[r];n.set(i,e[i])}return n.setValidator(t||null),n}return e.__extends(FormObject,a),Object.defineProperty(FormObject.prototype,"children",{get:function(){for(var e={},t=0,n=Object.keys(this.children_);t<n.length;t++){var r=n[t];e[r]=this.children_[r].decorated}return e},enumerable:!1,configurable:!0}),FormObject.prototype.get=function(e){if(e.indexOf("/")>-1||e.indexOf(":")>-1)return this.getByPath(e);if(!this.has(e))throw new l.ComponentNotFoundException(e,'No component named "'.concat(e,'" is currently present in "').concat(this.path,'".'));return this.children_[e].decorated},FormObject.prototype.getNameOf=function(e){for(var t=0,n=Object.keys(this.children_);t<n.length;t++){var r=n[t];if(this.children_[r].decorated.id===e.id)return r}return null},FormObject.prototype.set=function(e,t){var n=this;if(e.indexOf("/")>-1)return this.setByPath(e,t);if(e=FormObject.ValidateIdentifier(e),!i.isUndefined(this.children_[e])){if(this.children_[e].decorated.id===t.id)return;this.children_[e].unsetParent()}this.updateCollection((function(){n.children_[e]=t.setParent(n.buildParentComponentDecorator()),n.children_[e].propagateStatesToParent();var r=n.children_[e].decorated.validator;n.updateContainerValidator((function(t){null!==r?t.set(e,r):t.has(e)&&t.remove(e)}))})),this.dispatch(c.FormEvents.ComponentAdded,(function(){return new s.ComponentAddedFormEvent(n,n.children_[e].decorated,e)}))},FormObject.prototype.setByPath=function(e,n){var o=r.ltrim(e,"/").split("/");if(1===o.length)return this.set(o[0],n);var i=this;do{if(!i.isGroup())throw new t.UsageException('A component was found at "'.concat(i.path,'", but is not a container.'));var a=o.splice(0,1)[0];o.length>0?(i.has(a)||i.set(a,new FormObject),i=i.get(a)):i.set(a,n)}while(o.length>0)},FormObject.prototype.merge=function(e){var t=this;e.forEachDecorated((function(e){t.set(e.decorated.name,e.decorated)}))},FormObject.prototype.remove=function(e){var t=this;if(i.isUndefined(this.children_[e]))return null;var n=this.children_[e];return this.updateCollection((function(){n.removeStatesFromParent(),delete t.children_[e],n.unsetParent(),t.updateContainerValidator((function(t){t.has(e)&&t.remove(e)}))})),this.dispatch(c.FormEvents.ComponentRemoved,(function(){return new d.ComponentRemovedFormEvent(t,n.decorated,e)})),n.decorated},FormObject.prototype.clear=function(){var e=this,t=Object.assign({},this.children_);this.updateCollection((function(){e.children_={},e.updateValidator()}));for(var _loop_1=function(r){n.dispatch(c.FormEvents.ComponentRemoved,(function(){return new d.ComponentRemovedFormEvent(e,t[r].decorated,r)}))},n=this,r=0,o=Object.keys(t);r<o.length;r++){_loop_1(o[r])}},FormObject.prototype.has=function(e){return!i.isUndefined(this.children_[e])},FormObject.prototype.count=function(){return Object.keys(this.children_).length},FormObject.prototype.setValue=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];i.isUndefined(this.children_[r])||this.children_[r].setValue(e[r])}this.updateValue(),null===this.parent||this.hasContext(c.CallContext.Parent)||this.parent.updateValue()},FormObject.prototype.setDefaultValue=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];i.isUndefined(this.children_[r])||this.children_[r].setDefaultValue(e[r])}this.updateValue(),null===this.parent||this.hasContext(c.CallContext.Parent)||this.parent.updateValue()},FormObject.prototype.forEach=function(e,t){i.isUndefined(t)&&(t=this.foreachFilters[c.FilterGroup.External]);var r=n.getObjectKeys(t);e:for(var o=0,a=Object.keys(this.children_);o<a.length;o++){for(var s=a[o],d=0,u=r;d<u.length;d++){var l=u[d];if(this.children_[s].decorated[l]!==t[l])continue e}if(!1===e(this.children_[s].decorated,s))break}},FormObject.prototype.forEachDecorated=function(e){for(var t=0,n=Object.keys(this.children_);t<n.length;t++){var r=n[t];if(!1===e(this.children_[r],r))break}},FormObject.prototype.updateValue=function(){this.doUpdateValue(null)},FormObject.prototype.doUpdateValue=function(e){var t=this;null===e&&(e=this.cloneValue()),this.value={},this.forEach((function(e,n){t.value[n]=e.value}),this.foreachFilters[c.FilterGroup.UpdateValue]),null===this.parent||this.hasContext(c.CallContext.Parent)||this.parent.updateValue(),this.dispatch(c.FormEvents.ValueChanged,(function(){return new u.ValueChangedFormEvent(t,e,t.value)})),this.validateSelfIfStrategyMatches(c.ValidationStrategy.OnChange)},FormObject.prototype.updateCollection=function(e){var t=this.cloneValue();e(),this.doUpdateValue(t)},FormObject.prototype.cloneValue=function(){return Object.assign({},this.value)},FormObject.ValidateIdentifier=function(e){if(!(e=o.trim(e)))throw new t.UsageException("You cannot add a child with an empty identifier to a form object.");return e},FormObject}(a.AbstractFormGroup);exports.FormObject=h;
