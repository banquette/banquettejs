/*!
 * Banquette DomModules v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/service.decorator"),r=require("@banquette/dependency-injection/_cjs/prod/injector"),n=require("@banquette/dependency-injection/_cjs/prod/metadata.container"),i=require("@banquette/exception/_cjs/prod/exception.factory"),o=require("@banquette/exception/_cjs/prod/usage.exception"),u=require("@banquette/utils-misc/_cjs/prod/is-server"),c=require("@banquette/utils-string/_cjs/prod/case/camel-case"),a=require("@banquette/utils-string/_cjs/prod/case/kebab-case"),s=require("@banquette/utils-string/_cjs/prod/format/trim"),l=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),d=require("@banquette/utils-type/_cjs/prod/is-undefined"),M=require("./constant.js"),f=function(){function DomModulesScannerService(){this.modulesAttributeSelectors=null,this.existingModules=new WeakMap}var f;return f=DomModulesScannerService,DomModulesScannerService.prototype.scan=function(){if(!u.isServer()){var e=this;null===this.modulesAttributeSelectors&&(this.modulesAttributeSelectors=this.computeModulesAttributeSelectors());for(var t=0,n=Object.keys(this.modulesAttributeSelectors);t<n.length;t++){var a=n[t];document.querySelectorAll("[".concat(a,"]")).forEach(function(t,n){return function(u){if(u instanceof HTMLElement){var a=u.getAttribute(t);null!==a&&(a=s.trim(a));var f=c.camelCase(t),m=r.Injector.Get(n),p={},S=e.existingModules.get(u);if(l.isNullOrUndefined(S)&&(S={},e.existingModules.set(u,S)),!d.isUndefined(S[t]))throw new o.UsageException('Multiple initialization of the DOM module "'.concat(n[M.MODULE_NAME_CTOR_ATTR],'".'));if(a)if("{"===a[0])try{"object"!=typeof(p=JSON.parse(a))&&(p={})}catch(e){throw new o.UsageException('Failed to decode options of the DOM module "'.concat(n[M.MODULE_NAME_CTOR_ATTR],'". ')+"Please provide a valid JSON object.",i.ExceptionFactory.EnsureException(e))}else{var b=m.getDefaultOptionName();if(null===b)throw new o.UsageException('No default option name has been defined for the module "'.concat(n[M.MODULE_NAME_CTOR_ATTR],'".'));p[b]=a}u.removeAttribute(t),m.setElement(u),m.initialize(p),S[f]=m}}}(a,this.modulesAttributeSelectors[a]))}}},DomModulesScannerService.prototype.computeModulesAttributeSelectors=function(){for(var e={},t=0,r=n.MetadataContainer.GetForTag(M.ModuleInjectorTag).reduce((function(e,t){return t.tags.indexOf(M.ModuleInjectorTag)>-1&&!d.isUndefined(t.ctor[M.MODULE_NAME_CTOR_ATTR])&&e.push(t.ctor),e}),[]);t<r.length;t++){var i=r[t];e[f.MODULES_HTML_ATTRIBUTES_PREFIX+a.kebabCase(i[M.MODULE_NAME_CTOR_ATTR])]=i}return e},DomModulesScannerService.MODULES_HTML_ATTRIBUTES_PREFIX="dom-",DomModulesScannerService=f=e.__decorate([t.Service()],DomModulesScannerService)}();exports.DomModulesScannerService=f;
