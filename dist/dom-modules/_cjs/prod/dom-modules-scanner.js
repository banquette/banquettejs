/*!
 * Banquette DomModules v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/service.decorator"),n=require("@banquette/dependency-injection/_cjs/prod/injector"),r=require("@banquette/dependency-injection/_cjs/prod/metadata.container"),i=require("@banquette/exception/_cjs/prod/exception.factory"),o=require("@banquette/exception/_cjs/prod/usage.exception"),u=require("@banquette/utils-string/_cjs/prod/case/camel-case"),c=require("@banquette/utils-string/_cjs/prod/case/kebab-case"),a=require("@banquette/utils-string/_cjs/prod/format/trim"),s=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),l=require("@banquette/utils-type/_cjs/prod/is-undefined"),d=require("./constant.js"),M=function(){function DomModulesScannerService(){this.modulesAttributeSelectors=null,this.existingModules=new WeakMap}var M;return M=DomModulesScannerService,DomModulesScannerService.prototype.scan=function(){var e=this;null===this.modulesAttributeSelectors&&(this.modulesAttributeSelectors=this.computeModulesAttributeSelectors());for(var t=0,r=Object.keys(this.modulesAttributeSelectors);t<r.length;t++){var c=r[t];document.querySelectorAll("[".concat(c,"]")).forEach(function(t,r){return function(c){if(c instanceof HTMLElement){var M=c.getAttribute(t);null!==M&&(M=a.trim(M));var f=u.camelCase(t),p=n.Injector.Get(r),m={},S=e.existingModules.get(c);if(s.isNullOrUndefined(S)&&(S={},e.existingModules.set(c,S)),!l.isUndefined(S[t]))throw new o.UsageException('Multiple initialization of the DOM module "'.concat(r[d.MODULE_NAME_CTOR_ATTR],'".'));if(M)if("{"===M[0])try{"object"!=typeof(m=JSON.parse(M))&&(m={})}catch(e){throw new o.UsageException('Failed to decode options of the DOM module "'.concat(r[d.MODULE_NAME_CTOR_ATTR],'". ')+"Please provide a valid JSON object.",i.ExceptionFactory.EnsureException(e))}else{var b=p.getDefaultOptionName();if(null===b)throw new o.UsageException('No default option name has been defined for the module "'.concat(r[d.MODULE_NAME_CTOR_ATTR],'".'));m[b]=M}c.removeAttribute(t),p.setElement(c),p.initialize(m),S[f]=p}}}(c,this.modulesAttributeSelectors[c]))}},DomModulesScannerService.prototype.computeModulesAttributeSelectors=function(){for(var e={},t=0,n=r.MetadataContainer.GetForTag(d.ModuleInjectorTag).reduce((function(e,t){return t.tags.indexOf(d.ModuleInjectorTag)>-1&&!l.isUndefined(t.ctor[d.MODULE_NAME_CTOR_ATTR])&&e.push(t.ctor),e}),[]);t<n.length;t++){var i=n[t];e[M.MODULES_HTML_ATTRIBUTES_PREFIX+c.kebabCase(i[d.MODULE_NAME_CTOR_ATTR])]=i}return e},DomModulesScannerService.MODULES_HTML_ATTRIBUTES_PREFIX="dom-",DomModulesScannerService=M=e.__decorate([t.Service()],DomModulesScannerService)}();exports.DomModulesScannerService=M;
