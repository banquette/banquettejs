/*!
 * Banquette Http v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),n=require("@banquette/dependency-injection/_cjs/prod/decorator/service.decorator"),i=require("@banquette/event/_cjs/prod/event-dispatcher.service"),r=require("@banquette/utils-misc/_cjs/prod/is-server"),o=require("@banquette/utils-misc/_cjs/prod/proxy"),s=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),c=require("@banquette/utils-type/_cjs/prod/is-object"),a=require("./constants.js"),h=require("./event/network-availability-change.event.js"),v=function(){function NetworkWatcherService(e){this.eventDispatcher=e,this.isSupported=!r.isServer()&&c.isObject(window.navigator),this.isOnlineAttr=!this.isSupported||window.navigator.onLine}return NetworkWatcherService.prototype.isOnline=function(){return this.isOnlineAttr},NetworkWatcherService.prototype.watch=function(){this.isSupported&&s.isNullOrUndefined(this.onConnectionLostFn)&&(this.onConnectionRetrievedFn=o.proxy(this.onConnectionRetrieved,this),this.onConnectionLostFn=o.proxy(this.onConnectionLost,this),window.addEventListener("online",this.onConnectionRetrievedFn),window.addEventListener("offline",this.onConnectionLostFn))},NetworkWatcherService.prototype.unwatch=function(){s.isNullOrUndefined(this.onConnectionLostFn)||(window.addEventListener("online",this.onConnectionRetrievedFn),window.addEventListener("offline",this.onConnectionLostFn))},NetworkWatcherService.prototype.onConnectionLost=function(){this.isOnlineAttr=!1,this.dispatchEvents()},NetworkWatcherService.prototype.onConnectionRetrieved=function(){this.isOnlineAttr=!0,this.dispatchEvents()},NetworkWatcherService.prototype.dispatchEvents=function(){this.eventDispatcher.dispatch(this.isOnlineAttr?a.NetworkEvents.Online:a.NetworkEvents.Offline),this.eventDispatcher.dispatch(a.NetworkEvents.AvailabilityChange,new h.NetworkAvailabilityChangeEvent(this.isOnlineAttr))},NetworkWatcherService=e.__decorate([n.Service(),e.__param(0,t.Inject(i.EventDispatcherService)),e.__metadata("design:paramtypes",[Object])],NetworkWatcherService)}();exports.NetworkWatcherService=v;
