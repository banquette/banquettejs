/*!
 * Banquette Http v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/dependency-injection/_cjs/prod/injector"),s=require("@banquette/event/_cjs/prod/event-dispatcher.service"),n=require("@banquette/exception/_cjs/prod/exception.factory"),r=require("@banquette/utils-string/_cjs/prod/format/trim"),t=require("@banquette/utils-type/_cjs/prod/is-string"),o=require("@banquette/utils-type/_cjs/prod/is-undefined"),i=require("../constants.js"),p=require("../exception/invalid-response-type.exception.js"),u=require("./auto-detect.decoder.js"),c=Symbol("json");function stripXSSIPrefix(e){return")]}'\n"===e.substring(0,")]}'\n".length)?e.substring(")]}'\n".length):e}e.Injector.Get(s.EventDispatcherService).subscribe(i.HttpEvents.BeforeResponse,(function onBeforeResponse(e){if(function expectJson(e){if(e.request.responseType===c)return!0;if(e.request.responseType!==u.ResponseTypeAutoDetect||!t.isString(e.response.response))return!1;if("json"===e.response.responseType||"application/json"===e.response.headers["content-type"])return!0;if(!e.response.responseType&&o.isUndefined(e.response.headers["content-type"])){var s=r.trim(stripXSSIPrefix(e.response.response));return"["===s[0]||"{"===s[0]}return!1}(e))if(e.stopPropagation(),null!==e.response.response&&""!==e.response.response){if(!t.isString(e.response.response))throw new p.InvalidResponseTypeException(e.request.response,"A string is expected for a JSON response.");try{e.response.response=JSON.parse(r.trim(stripXSSIPrefix(e.response.response)))}catch(s){throw new p.InvalidResponseTypeException(e.request.response,"The response is not a valid JSON string.",n.ExceptionFactory.EnsureException(s))}}else e.response.response={}}),0,null,[i.DecoderTag]),exports.ResponseTypeJson=c,exports.XSSIPrefix=")]}'\n";
