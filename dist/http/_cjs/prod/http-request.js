/*!
 * Banquette Http v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@banquette/config/_cjs/prod/config/configuration.service"),t=require("@banquette/dependency-injection/_cjs/prod/injector"),r=require("@banquette/exception/_cjs/prod/usage.exception"),i=require("@banquette/utils-object/_cjs/prod/clone-deep"),s=require("@banquette/utils-object/_cjs/prod/extend"),a=require("@banquette/utils-string/_cjs/prod/format/replace-string-variables"),n=require("./config.js"),o=require("./constants.js"),u=require("./headers-bag.js");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=_interopDefaultLegacy(require("qs")),l=null,c=function(){function HttpRequest(e,t,r,i,s,a,n,o,p,l,c,h,y,f,d){this.method=e,this.url=t,this.params=r,this.payload=i,this.payloadType=s,this.responseType=a,this.timeout=o,this.retry=p,this.retryDelay=l,this.priority=c,this.withCredentials=h,this.mimeType=y,this.tags=f,this.extras=d,this.id=++HttpRequest.MaxId,this.tryCount=0,this.canceled=!1,this.cancelCallback=null,this.headers=n instanceof u.HeadersBag?n:u.HeadersBag.FromMap(n)}return Object.defineProperty(HttpRequest.prototype,"staticUrl",{get:function(){var e=Object.keys(this.params);if(!e.length)return this.url;for(var t={},r={},i=this.extractUrlVariables(this.url),n=0,u=e;n<u.length;n++){var l=u[n],c=this.params[l];c.type===o.UrlParameterType.Auto&&(c.type=i.indexOf(l)>-1?o.UrlParameterType.Url:o.UrlParameterType.Query),c.type===o.UrlParameterType.Url?r[l]=c.value:t[l]=c.value}var h=a.replaceStringVariables(this.url,r,"{","}");if(Object.keys(t).length>0){if(h.indexOf("?")>-1){var y=p.default.parse(h.substring(h.indexOf("?")+1));t=s.extend({},[y,t]),h=h.substring(0,h.indexOf("?"))}h+="?"+p.default.stringify(t,HttpRequest.GetConfiguration().queryString)}return h},enumerable:!1,configurable:!0}),HttpRequest.prototype.incrementTryCount=function(){this.tryCount=this.tryCount+1},HttpRequest.prototype.setAdapter=function(e){if(this.adapter)throw new r.UsageException("An adapter has already been set.");this.adapter=e,this.canceled&&e.cancel()},HttpRequest.prototype.setResponse=function(e){if(this.response)throw new r.UsageException("A response has already been set.");this.response=e},HttpRequest.prototype.setParam=function(e,t,r){void 0===r&&(r=o.UrlParameterType.Auto),this.params[e]={type:r,value:String(t)}},HttpRequest.prototype.setCancelCallback=function(e){this.cancelCallback=e},HttpRequest.prototype.cancel=function(){if(!this.adapter)return this.cancelCallback&&this.cancelCallback(),void(this.canceled=!0);this.adapter.cancel()},HttpRequest.prototype.clone=function(){return new HttpRequest(this.method,this.url,Object.assign({},this.params),i.cloneDeep(this.payload),this.payloadType,this.responseType,Object.assign({},this.headers),this.timeout,this.retry,this.retryDelay,this.priority,this.withCredentials,this.mimeType,this.tags,i.cloneDeep(this.extras))},HttpRequest.prototype.extractUrlVariables=function(e){for(var t,r=[],i=new RegExp("{([a-z0-9*._-]+)}","gi");null!==(t=i.exec(e));)r.push(t[1]);return r},HttpRequest.GetConfiguration=function(){return null===l&&(l=t.Injector.Get(e.ConfigurationService).get(n.HttpConfigurationSymbol)),l},HttpRequest.MaxId=0,HttpRequest}();exports.HttpRequest=c;
