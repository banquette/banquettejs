/*!
 * Banquette Validation v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/module.decorator"),a=require("@banquette/dependency-injection/_cjs/prod/injector"),n=require("@banquette/exception/_cjs/prod/usage.exception"),i=require("@banquette/http/_cjs/prod/constants"),s=require("@banquette/http/_cjs/prod/exception/request-canceled.exception"),u=require("@banquette/http/_cjs/prod/http-request"),o=require("@banquette/http/_cjs/prod/http-request.factory"),c=require("@banquette/http/_cjs/prod/http.service"),p=require("@banquette/utils-object/_cjs/prod/extend"),d=require("@banquette/utils-type/_cjs/prod/ensure-array"),l=require("@banquette/utils-type/_cjs/prod/is-function"),q=require("@banquette/utils-type/_cjs/prod/is-object"),y=require("@banquette/utils-type/_cjs/prod/is-string"),f=require("@banquette/utils-type/_cjs/prod/is-type"),h=require("@banquette/utils-type/_cjs/prod/is-undefined"),b=require("../constant.js"),j=require("../create-validator.js"),v=Symbol(),x=function(){function AjaxValidator(e){var t=this;this.http=e,this.message="Invalid value.",this.type="ajax",this.responseHandler=function(e,r){e.isError?r.fail(e.error):2!==Math.floor(.01*e.httpStatusCode)&&r.addViolation(t.type,t.message)}}return AjaxValidator.prototype.validate=function(e){var t=this;if(!f.isType(this.requestFactory,l.isFunction))throw new n.UsageException("You must define a request factory.");var r=this.requestFactory(e.value);r.payload===v&&(r.payload=q.isObject(e.value)?e.value:{value:e.value});var a=this.http.send(r),i=new Promise((function(r,n){a.promise.then((function(){t.responseHandler(a,e.result),r(e)})).catch((function(r){r.error instanceof s.RequestCanceledException&&e.result.cancel(),t.responseHandler(a,e.result),n(r.error)}))}));return e.result.delayResponse(i,(function(){a.request.cancel()})),e.result},AjaxValidator=e.__decorate([r.Module(),e.__param(0,t.Inject(c.HttpService)),e.__metadata("design:paramtypes",[c.HttpService])],AjaxValidator)}();exports.Ajax=function Ajax(e,t,r){void 0===r&&(r={});var n,s=a.Injector.Get(x);if(e instanceof u.HttpRequest){var c=e;e=function(){return c.clone()}}else if(y.isString(e)&&(e={url:e,payload:v}),n=e,q.isObject(n)){var l=e;e=function(){return o.HttpRequestFactory.Create(p.extend({method:i.HttpMethod.POST,payload:v},l))}}return s.requestFactory=e,h.isUndefined(t)||(s.responseHandler=t),h.isUndefined(r.message)||(s.message=r.message),h.isUndefined(r.type)||(s.type=r.type),j.createValidator(s,[b.ASYNC_TAG].concat(d.ensureArray(r.tags)),d.ensureArray(r.groups))},exports.AjaxValidator=x,exports.AutoPayloadSymbol=v;
