/*!
 * Banquette VueTypescript v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@banquette/utils-string/_cjs/prod/format/trim"),t=require("@banquette/utils-string/_cjs/prod/insert-in-string"),r=require("./extract-css-selectors.js");exports.injectContextInCssSource=function injectContextInCssSource(e,s,i,l){e=n.trim(e.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));for(var u=r.extractCssSelectors(e).reverse(),g=[["{","}"],["(",")"],["[","]"]],c=["{","(","["],a=0;a<u.length;++a){var o=[];if(null!==l){for(var f=null,b=null,h=[],x=null,v=0;v<u[a][0].length;v++){var p=u[a][0][v],d=c.indexOf(p);if(d>-1&&!b&&(h.push(d),x=h[h.length-1]),p===b?b=null:b||'"'!==p&&"'"!==p||(b=p),!b){if(" "!==p||h.length||(f=null),":"===p){if(f=null===f?v:f,":deep"===u[a][0].substring(v,v+5)){var S=u[a][1]+v,m=e.indexOf("(",S+5),I=e.indexOf(")",S+5);for(m>S&&I>S&&(e=(e=e.substring(0,I)+e.substring(I+1)).substring(0,S)+e.substring(m+1));--v>=0&&u[a][0][v].match(/\s/););f=v+1;break}if(":global"===u[a][0].substring(v,v+7)){f=null;S=u[a][1]+v,m=e.indexOf("(",S+7),I=e.indexOf(")",S+7);for(var O=e.substring(m+1,I),j=a+(I-S)+1;j<u[a][0].length&&u[a][0][j].match(/\s/)&&++j;);e=n.trim(e.substring(0,S)+e.substring(S+(j-a))),u[a][0]=u[a][0].substring(j),u[a][2]-=j-a-1,o.push(O),--v}}null!==x&&p===g[x][1]&&(h.pop(),x=h.length>0?h[h.length-1]:null)}}null===f&&(f=u[a][0].length),e=t.insertInString(e,f+u[a][1],"[".concat(l,"]")+(0===f?" ":""))}if("&"===u[a][0][0]){e=e.substring(0,u[a][1])+e.substring(u[a][1]+1);for(var q=u[a][1];e[q].match(/\s/)&&++q<e.length;);e=t.insertInString(e,q,"[".concat(i,"]"))}else e=t.insertInString(e,u[a][1],"[".concat(i,"] "));e=t.insertInString(e,u[a][1],".".concat(s," ").concat(o.join(" ")+(o.length?" ":"")))}return e};
