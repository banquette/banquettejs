/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";var e=require("../_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/injector"),o=require("@banquette/event/_cjs/prod/event-dispatcher.service"),n=require("@banquette/utils-dom/_cjs/prod/add-event-listener"),a=require("@banquette/utils-misc/_cjs/prod/is-server"),i=require("@banquette/utils-misc/_cjs/prod/proxy"),r=require("@banquette/vue-typescript/_cjs/prod/decorator/component.decorator"),s=require("@banquette/vue-typescript/_cjs/prod/decorator/computed.decorator"),p=require("@banquette/vue-typescript/_cjs/prod/decorator/expose.decorator"),l=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),d=require("@banquette/vue-typescript/_cjs/prod/decorator/ref.decorator"),c=require("@banquette/vue-typescript/_cjs/prod/decorator/template-ref.decorator"),u=require("@banquette/vue-typescript/_cjs/prod/decorator/themeable.decorator"),g=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),m=require("@banquette/vue-typescript/_cjs/prod/theme/bind-theme.directive"),y=require("@banquette/vue-typescript/_cjs/prod/vue"),_=require("@vueuse/core"),h=require("vue");require("../misc/call/call.component.vue.js"),require("../misc/conditional-wrapper/conditional-wrapper.component.vue.js"),require("../misc/remote/remote.component.vue.js"),require("../misc/teleport/teleport.component.vue.js"),require("../misc/click-outside.directive.js"),require("../misc/collapsable.directive.js"),require("../misc/stick-to.directive.js"),require("../misc/teleport.directive.js"),require("@banquette/api/_cjs/prod/api.service"),require("@banquette/vue-typescript/_cjs/prod/vue-builder"),require("../misc/client-only.component.vue.js"),require("../overlay/overlay.component.vue.js");var b=require("./constant.js"),v=require("./event/hide-dialog.event-arg.js"),f=require("./theme-configuration.js"),D=require("../overlay/overlay.component.vue_vue_type_script_lang.vue.js"),C=require("../misc/client-only.component.vue_vue_type_script_lang.vue.js"),q=function(y){function DialogComponent(){var e=y.call(this)||this;return e.slotBag={},e.dragTranslation={x:0,y:0},e.dragging=!1,e.internalVisible=!1,e.unsubscribeFunctions=[],e.draggableUnsubscribeFunctions=[],e.oldBodyOverflow=null,e.shown=!1,e.eventDispatcher=t.Injector.Get(o.EventDispatcherService),e}var q;return e.__extends(DialogComponent,y),q=DialogComponent,Object.defineProperty(DialogComponent.prototype,"isVisible",{get:function(){return this.visible||this.internalVisible},set:function(e){this.$emit("update:visible",e)},enumerable:!1,configurable:!0}),Object.defineProperty(DialogComponent.prototype,"rendered",{get:function(){return this.isVisible||this.shown&&!this.destroyOnClose},enumerable:!1,configurable:!0}),Object.defineProperty(DialogComponent.prototype,"hasHeader",{get:function(){return this.hasSlot("header")},enumerable:!1,configurable:!0}),Object.defineProperty(DialogComponent.prototype,"hasFooter",{get:function(){return this.hasSlot("footer")},enumerable:!1,configurable:!0}),Object.defineProperty(DialogComponent.prototype,"bindings",{get:function(){return{close:i.proxy(this.close,this),bag:this.slotBag}},enumerable:!1,configurable:!0}),Object.defineProperty(DialogComponent.prototype,"dragTranslationStyle",{get:function(){return this.draggable?{transform:"translate(".concat(this.dragTranslation.x,"px, ").concat(this.dragTranslation.y,"px)")}:{}},enumerable:!1,configurable:!0}),DialogComponent.prototype.mounted=function(){this.unsubscribeFunctions.push(n.addEventListener(document,"keydown",i.proxy(this.onDocumentKeyDown,this))),this.unsubscribeFunctions.push(this.eventDispatcher.subscribe(b.DialogEvents.Show,i.proxy(this.onShowByEvent,this))),this.unsubscribeFunctions.push(this.eventDispatcher.subscribe(b.DialogEvents.Hide,i.proxy(this.onHideByEvent,this))),this.unsubscribeFunctions.push(this.eventDispatcher.subscribe(b.DialogEvents.HideAll,i.proxy(this.onHideByEvent,this)))},DialogComponent.prototype.unmounted=function(){for(var e=0,t=this.unsubscribeFunctions;e<t.length;e++){(0,t[e])()}this.unsubscribeFunctions=[],this.lockScroll&&this.updateScrollLock(!1),this.onIdChange(null,this.id),this.freeDraggable()},DialogComponent.prototype.onIdChange=function(e,t){if(t){var o=q.UsedIds.indexOf(t);o>-1&&q.UsedIds.splice(o,1)}if(e){if(q.UsedIds.indexOf(e)>-1)return void console.warn('The id "'.concat(e,'" is already used by another dialog.'));q.UsedIds.push(e)}},DialogComponent.prototype.onVisibleChange=function(e){var t=this;e?(this.lockScroll&&this.updateScrollLock(!0),this.shown=!0,this.draggable&&setTimeout((function(){t.makeDraggable()}))):(this.shown=!1,this.freeDraggable())},DialogComponent.prototype.onLockScrollChange=function(e){this.visible&&this.updateScrollLock(e)},DialogComponent.prototype.close=function(){this.isVisible=!1,this.internalVisible=!1,this.lockScroll&&this.updateScrollLock(!1),this.$emit("close")},DialogComponent.prototype.onDocumentKeyDown=function(e){"Escape"===e.key&&this.closeOnEscape&&(e.stopPropagation(),this.close())},DialogComponent.prototype.onOverlayMouseDown=function(e){this.closeByMask&&e.target===this.overlayEl&&this.close()},DialogComponent.prototype.onShowByEvent=function(e){e.id===this.id&&(this.internalVisible=!0,this.slotBag=e.args||{})},DialogComponent.prototype.onHideByEvent=function(e){e instanceof v.HideDialogEventArg&&e.id!==this.id||this.close()},DialogComponent.prototype.updateScrollLock=function(e){a.isServer()||(e?1==++q.ScrollLockedCount&&(this.oldBodyOverflow=document.body.style.overflow,document.body.style.overflow="hidden"):--q.ScrollLockedCount||null===this.oldBodyOverflow||(document.body.style.overflow=this.oldBodyOverflow,this.oldBodyOverflow=null))},DialogComponent.prototype.makeDraggable=function(){var e=this;if(this.$refs.header){var t={x:0,y:0},o=null,n=_.useDraggable(this.$refs.header);this.draggableUnsubscribeFunctions.push(h.watch(n.isDragging,(function(n){n&&(t.x=e.dragTranslation.x,t.y=e.dragTranslation.y,o=null),e.dragging=n}))),this.draggableUnsubscribeFunctions.push(h.watch([n.x,n.y],(function(n){null===o&&(o={x:n[0],y:n[1]}),e.dragTranslation.x=t.x+(n[0]-o.x),e.dragTranslation.y=t.y+(n[1]-o.y)})))}},DialogComponent.prototype.freeDraggable=function(){for(var e=0,t=this.draggableUnsubscribeFunctions;e<t.length;e++){(0,t[e])()}this.draggableUnsubscribeFunctions=[],this.dragTranslation.x=0,this.dragTranslation.y=0},DialogComponent.ScrollLockedCount=0,DialogComponent.UsedIds=[],e.__decorate([l.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"visible",void 0),e.__decorate([l.Prop({type:String,default:null}),e.__metadata("design:type",Object)],DialogComponent.prototype,"id",void 0),e.__decorate([l.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"lockScroll",void 0),e.__decorate([l.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"modal",void 0),e.__decorate([l.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"closeByMask",void 0),e.__decorate([l.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"closeOnEscape",void 0),e.__decorate([l.Prop({type:String,default:"body"}),e.__metadata("design:type",Object)],DialogComponent.prototype,"teleport",void 0),e.__decorate([l.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"destroyOnClose",void 0),e.__decorate([l.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"showClose",void 0),e.__decorate([l.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"draggable",void 0),e.__decorate([s.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[Boolean])],DialogComponent.prototype,"isVisible",null),e.__decorate([s.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],DialogComponent.prototype,"rendered",null),e.__decorate([s.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],DialogComponent.prototype,"hasHeader",null),e.__decorate([s.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],DialogComponent.prototype,"hasFooter",null),e.__decorate([s.Computed(),e.__metadata("design:type",Object),e.__metadata("design:paramtypes",[])],DialogComponent.prototype,"bindings",null),e.__decorate([p.Expose(),e.__metadata("design:type",Object)],DialogComponent.prototype,"slotBag",void 0),e.__decorate([p.Expose(),e.__metadata("design:type",Object)],DialogComponent.prototype,"dragTranslation",void 0),e.__decorate([p.Expose(),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"dragging",void 0),e.__decorate([c.TemplateRef("overlay"),e.__metadata("design:type",Element)],DialogComponent.prototype,"overlayEl",void 0),e.__decorate([s.Computed(),e.__metadata("design:type",Object),e.__metadata("design:paramtypes",[])],DialogComponent.prototype,"dragTranslationStyle",null),e.__decorate([d.Ref(),e.__metadata("design:type",Boolean)],DialogComponent.prototype,"internalVisible",void 0),e.__decorate([g.Watch("id",{immediate:g.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Object,Object]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"onIdChange",null),e.__decorate([g.Watch("isVisible",{immediate:!1}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Boolean]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"onVisibleChange",null),e.__decorate([g.Watch("lockScroll",{immediate:g.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Boolean]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"onLockScrollChange",null),e.__decorate([p.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"close",null),e.__decorate([p.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[KeyboardEvent]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"onDocumentKeyDown",null),e.__decorate([p.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[MouseEvent]),e.__metadata("design:returntype",void 0)],DialogComponent.prototype,"onOverlayMouseDown",null),DialogComponent=q=e.__decorate([u.Themeable(f.ThemeConfiguration),r.Component({name:"bt-dialog",components:[D,C],directives:[m.BindThemeDirective],emits:["update:visible","close"]}),e.__metadata("design:paramtypes",[])],DialogComponent)}(y.Vue);module.exports=q;
