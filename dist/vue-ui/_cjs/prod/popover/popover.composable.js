/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../_virtual/_tslib.js"),t=require("@banquette/utils-misc/_cjs/prod/noop"),o=require("@banquette/utils-string/_cjs/prod/format/trim"),i=require("@banquette/utils-type/_cjs/prod/ensure-array"),r=require("@banquette/utils-type/_cjs/prod/is-array"),n=require("@banquette/utils-type/_cjs/prod/is-number"),a=require("@banquette/utils-type/_cjs/prod/is-object"),s=require("@banquette/utils-type/_cjs/prod/is-string"),p=require("@banquette/utils-type/_cjs/prod/is-undefined"),l=require("@banquette/vue-typescript/_cjs/prod/component-aware.composable"),d=require("@banquette/vue-typescript/_cjs/prod/decorator/composable.decorator"),u=require("@banquette/vue-typescript/_cjs/prod/decorator/expose.decorator"),c=require("@banquette/vue-typescript/_cjs/prod/decorator/lifecycle.decorator"),m=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),h=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),v=function(l){function PopoverComposable(){var e=null!==l&&l.apply(this,arguments)||this;return e.config={content:null,allowHtml:!1,visible:!1,showArrow:!0,teleport:"auto",zIndex:"auto",stickToOptions:{}},e.targets=[],e.activeTarget=null,e.unsubscribeFunctions={},e.scheduledVisibilityChange=null,e.popoverEl=null,e}var v;return e.__extends(PopoverComposable,l),v=PopoverComposable,PopoverComposable.prototype.beforeUnmount=function(){this.clearEventsListeners(),null!==this.scheduledVisibilityChange&&this.scheduledVisibilityChange.timerId&&window.clearTimeout(this.scheduledVisibilityChange.timerId)},PopoverComposable.prototype.show=function(){var e=this;this.config.visible||(this.config.visible=!0,this.interactive&&this.component.$nextTick((function(){e.component.$refs.popover instanceof Element&&e.bindInteractionRetainers(e.component.$refs.popover)})))},PopoverComposable.prototype.hide=function(){this.config.visible=!1,this.clearEventsListeners("retainers")},PopoverComposable.prototype.updateBaseConfig=function(){this.config.content=this.content,this.config.showArrow=this.showArrow,this.config.allowHtml=this.allowHtml,this.config.teleport=this.teleport,this.config.zIndex=this.zIndex,null!==this.visible&&(this.config.visible=this.visible)},PopoverComposable.prototype.updateStickToOptions=function(){var e=(s.isString(this.target)?this.target.split(","):i.ensureArray(this.target)).map((function(e){return o.trim(e)}));if(!e.length&&this.component.$el&&this.component.$el.parentElement instanceof Element){var r=this.component.$el.parentElement;r&&r.$el?this.targets=[r.$el]:this.targets=[this.component.$el.parentElement]}else{this.targets=[];for(var n=0,a=e;n<a.length;n++){var p=a[n],l=this.resolveTarget(p);null!==l&&(this.targets=this.targets.concat(l))}}this.config.stickToOptions={forceUpdate:t.noop,placement:this.placement,target:this.activeTarget||this.targets[0]||null,popper:{modifiers:[{name:"preventOverflow",enabled:this.preventOverflow,options:{altAxis:!0}},{name:"computeStyles",enabled:this.computeStyles,options:{adaptive:!1}},{name:"flip",enabled:this.flip},{name:"arrow",enabled:this.showArrow,options:{padding:10}},{name:"offset",enabled:null!==this.offset,options:{offset:this.offset}}]}},Object.assign(this.config.stickToOptions.popper,this.popperOptions||{})},PopoverComposable.prototype.updateEvents=function(){if(this.clearEventsListeners(),null===this.visible)for(var e=0,t=this.targets;e<t.length;e++){for(var o=t[e],i=0,r=this.showOn;i<r.length;i++){var n=r[i];p.isUndefined(v.SHOW_EVENTS_MAP[n])||(this.registerShowEvent(o,v.SHOW_EVENTS_MAP[n].show),null===this.hideOn&&this.registerHideEvent(o,v.SHOW_EVENTS_MAP[n].hide))}if(null!==this.hideOn)for(var a=0,s=this.hideOn;a<s.length;a++){n=s[a];this.registerHideEvent(o,n)}}},PopoverComposable.prototype.bindInteractionRetainers=function(e){var o=this;this.popoverEl=e,this.clearEventsListeners("retainers"),this.addEventListener(this.popoverEl,"mousedown",t.noop,"retainers"),this.addEventListener(this.popoverEl,"click",t.noop,"retainers"),this.addEventListener(this.popoverEl,"mouseenter",(function(){null!==o.scheduledVisibilityChange&&o.scheduledVisibilityChange.timerId&&(window.clearTimeout(o.scheduledVisibilityChange.timerId),o.scheduledVisibilityChange.timerId=null)}),"retainers"),this.addEventListener(this.popoverEl,"mouseleave",(function(){null!==o.scheduledVisibilityChange&&(o.scheduledVisibilityChange.timerId=window.setTimeout((function(){o.hide(),o.scheduledVisibilityChange=null}),o.scheduledVisibilityChange.delay))}),"retainers")},PopoverComposable.prototype.registerShowEvent=function(e,t){var o=this;this.addEventListener(e,t,(function(){o.config.stickToOptions.target!==e&&(o.activeTarget=e,o.updateStickToOptions()),o.scheduleVisibilityChange(!0,t)}))},PopoverComposable.prototype.registerHideEvent=function(e,t){var o=this;"-outside"===t.substring(t.length-8)&&(e=document.documentElement,t=t.substring(0,t.length-8)),this.addEventListener(e,t,(function(){o.scheduleVisibilityChange(!1,t)}))},PopoverComposable.prototype.resolveTarget=function(e){if(e instanceof Element)return[e];if(s.isString(e)&&a.isObject(this.component.$refs))for(var t=this.component.$parent;t;){var o=t.$refs[e];if(o instanceof Element)return[o];if(a.isObject(o)&&o.$el instanceof Element)return[o.$el];t=t.$parent}if(s.isString(e)){for(var i=[],r=0,n=document.querySelectorAll(e);r<n.length;r++){var p=n[r];p instanceof Element&&i.push(p)}return i.length>0?i:(console.warn('Failed to resolve target string "'.concat(e,'". ')+"Please ensure it's a valid selector or ref name."),null)}return null},PopoverComposable.prototype.addEventListener=function(e,t,o,i){void 0===i&&(i="default");var eventCallback=function(e){e.stopPropagation(),o()};e.addEventListener(t,eventCallback),p.isUndefined(this.unsubscribeFunctions[i])&&(this.unsubscribeFunctions[i]=[]),this.unsubscribeFunctions[i].push((function(){e.removeEventListener(t,eventCallback)}))},PopoverComposable.prototype.clearEventsListeners=function(e){void 0===e&&(e=null);for(var t=0,o=Object.keys(this.unsubscribeFunctions);t<o.length;t++){var i=o[t];if(null===e||i===e){for(var r=0,n=this.unsubscribeFunctions[i];r<n.length;r++){(0,n[r])()}delete this.unsubscribeFunctions[i]}}},PopoverComposable.prototype.scheduleVisibilityChange=function(e,t){var o=this;null!==this.scheduledVisibilityChange&&this.scheduledVisibilityChange.timerId&&window.clearTimeout(this.scheduledVisibilityChange.timerId);var apply=function(){e?o.show():o.hide(),o.scheduledVisibilityChange=null},i=e?this.showDelay:this.hideDelay,r=n.isNumber(i)?i:i[t]||0;r>0?this.scheduledVisibilityChange={timerId:window.setTimeout(apply,r),delay:r}:apply()},PopoverComposable.SHOW_EVENTS_MAP={mouseenter:{show:"mouseenter",hide:"mouseleave"},mousedown:{show:"mousedown",hide:"mousedown-outside"},click:{show:"click",hide:"click-outside"},focus:{show:"focus",hide:"blur"}},e.__decorate([m.Prop({type:[String,Object],default:null}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"target",void 0),e.__decorate([m.Prop({type:String,default:null}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"content",void 0),e.__decorate([m.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"allowHtml",void 0),e.__decorate([m.Prop({type:String,default:"top"}),e.__metadata("design:type",String)],PopoverComposable.prototype,"placement",void 0),e.__decorate([m.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"showArrow",void 0),e.__decorate([m.Prop({type:Boolean,default:null}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"visible",void 0),e.__decorate([m.Prop({type:[Array,String],default:"mouseenter",transform:function(e){return s.isString(e)?e.split(",").map((function(e){return o.trim(e)})):i.ensureArray(e)}}),e.__metadata("design:type",Array)],PopoverComposable.prototype,"showOn",void 0),e.__decorate([m.Prop({type:[Array,String],default:null,transform:function(e){return null===e?null:s.isString(e)?e.split(",").map((function(e){return o.trim(e)})):i.ensureArray(e)}}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"hideOn",void 0),e.__decorate([m.Prop({default:0,transform:function(e){return a.isObject(e)?e:parseInt(e,10)}}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"showDelay",void 0),e.__decorate([m.Prop({default:{mouseleave:0},transform:function(e){return a.isObject(e)?e:parseInt(e,10)}}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"hideDelay",void 0),e.__decorate([m.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"interactive",void 0),e.__decorate([m.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"flip",void 0),e.__decorate([m.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"preventOverflow",void 0),e.__decorate([m.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],PopoverComposable.prototype,"computeStyles",void 0),e.__decorate([m.Prop({type:[Object,String],default:"auto"}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"teleport",void 0),e.__decorate([m.Prop({type:[Number,String],default:"auto"}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"zIndex",void 0),e.__decorate([m.Prop({type:[Array,Number],default:[0,10],transform:function(e){return null===e?null:r.isArray(e)?e:[0,parseInt(e,10)]}}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"offset",void 0),e.__decorate([m.Prop({type:Object,default:null}),e.__metadata("design:type",Object)],PopoverComposable.prototype,"popperOptions",void 0),e.__decorate([u.Expose(),e.__metadata("design:type",Object)],PopoverComposable.prototype,"config",void 0),e.__decorate([c.Lifecycle("beforeUnmount"),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"beforeUnmount",null),e.__decorate([u.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"show",null),e.__decorate([u.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"hide",null),e.__decorate([h.Watch(["content","visible","allowHtml","showArrow","teleport","zIndex"],{immediate:h.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"updateBaseConfig",null),e.__decorate([h.Watch(["target","placement","offset","popperOptions"],{immediate:h.ImmediateStrategy.Mounted}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"updateStickToOptions",null),e.__decorate([h.Watch(["target","visible"],{immediate:h.ImmediateStrategy.Mounted}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],PopoverComposable.prototype,"updateEvents",null),PopoverComposable=v=e.__decorate([d.Composable()],PopoverComposable)}(l.ComponentAwareComposable);exports.PopoverComposable=v;
