/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../_virtual/_tslib.js"),t=require("@banquette/utils-misc/_cjs/prod/are-equal"),i=require("@banquette/utils-misc/_cjs/prod/proxy"),r=require("@banquette/utils-misc/_cjs/prod/throttle"),s=require("@banquette/utils-object/_cjs/prod/clone-deep-primitive"),o=require("@banquette/utils-string/_cjs/prod/format/trim"),n=require("@banquette/utils-type/_cjs/prod/is-array"),p=require("@banquette/utils-type/_cjs/prod/is-function"),u=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),c=require("@banquette/utils-type/_cjs/prod/is-object"),a=require("@banquette/utils-type/_cjs/prod/is-string"),l=require("@banquette/utils-type/_cjs/prod/is-undefined"),b=require("@banquette/vue-typescript/_cjs/prod/decorator/directive.decorator"),v=require("@popperjs/core"),h=require("@vueuse/core"),d=function(){function StickToDirective(){this.target=null,this.mutationObserverUnsubscribeFn=null,this.sizeObserverUnsubscribeFns=[],this.popper=null}var d;return d=StickToDirective,StickToDirective.prototype.mounted=function(e,t){this.updated(e,t)},StickToDirective.prototype.forceUpdate=function(){this.popper&&this.popper.forceUpdate()},StickToDirective.prototype.updated=function(e,r){this.el=e,this.bindings=r;var s=this.resolveOptions(r);t.areEqual(this.options||{},s)||(this.options=s,r.value.forceUpdate=i.proxy(this.forceUpdate,this),this.doUpdate())},StickToDirective.prototype.unmounted=function(){var e=this;null!==this.mutationObserverUnsubscribeFn&&this.mutationObserverUnsubscribeFn(),window.setTimeout((function(){e.destroyPopper()}),2e3)},StickToDirective.prototype.doUpdate=function(){var e=this.resolveTarget();null!==e?this.options.enabled?this.attach(this.el,e):this.destroyPopper():(null!==this.target&&this.destroyPopper(),(this.bindings.modifiers.observe||this.bindings.modifiers.ref)&&this.observe()),this.target=e},StickToDirective.prototype.attach=function(e,t){var i=this,r=e.style.position;"fixed"!==r&&"absolute"!==r&&(e.style.position="absolute",r="absolute");var s=Object.assign({strategy:r},c.isObject(this.options)&&c.isObject(this.options.popper)?this.options.popper:{});this.target===t&&this.popper?this.popper.setOptions(s).catch(console.error):(this.destroyPopper(),this.popper=v.createPopper(t,e,s),this.popper.forceUpdate(),t instanceof HTMLElement&&this.observeTargetSize(t),this.observeTargetSize(e)),window.setTimeout((function(){i.popper&&i.popper.forceUpdate()}))},StickToDirective.prototype.resolveTarget=function(){var e=this.options.target;if(e instanceof Element)return e;if(!a.isString(e))return null;if(!this.bindings.modifiers.ref)return"#"===(e=o.trim(e))[0]?window.document.documentElement.querySelector(e):null!==this.el.parentElement?this.el.parentElement.querySelector(e):null;if(c.isObject(this.el.__vueParentComponent)&&c.isObject(this.el.__vueParentComponent.ctx)){var t=this.el.__vueParentComponent.ctx;do{var i=c.isObject(t.$refs)?t.$refs[e]:null;if(!u.isNullOrUndefined(i)&&i.$el instanceof Element)return i.$el;t=t.$parent}while(t)}return null},StickToDirective.prototype.observe=function(){var e=this;null===this.mutationObserverUnsubscribeFn&&(this.mutationObserverUnsubscribeFn=d.Observe(r.throttle((function(){var t=e.resolveTarget();null!==t&&(null!==e.mutationObserverUnsubscribeFn&&(e.mutationObserverUnsubscribeFn(),e.mutationObserverUnsubscribeFn=null),t!==e.target&&(e.target=t,e.attach(e.el,e.target)))}),50)))},StickToDirective.prototype.observeTargetSize=function(e){var t=this;this.sizeObserverUnsubscribeFns.push(h.useResizeObserver(e,(function(){t.popper&&t.popper.forceUpdate()})).stop)},StickToDirective.prototype.resolveOptions=function(e){var t=this,i=p.isFunction(e.value)?e.value():e.value;return i instanceof Element||!c.isObject(i)?{target:i,enabled:!this.options||this.options.enabled}:((i=s.cloneDeepPrimitive(i)).placement=i.placement||"bottom",i.popper=i.popper||{},i.forceUpdate=this.options?this.options.forceUpdate:function(){return t.forceUpdate()},l.isUndefined(i.popper.placement)&&(i.popper.placement=i.placement),l.isUndefined(i.offset)||(n.isArray(i.popper.modifiers)||(i.popper.modifiers=[]),i.popper.modifiers.push({name:"offset",options:{offset:i.offset}})),l.isUndefined(i.enabled)&&(i.enabled=!this.options||this.options.enabled),i)},StickToDirective.prototype.destroyPopper=function(){for(var e=0,t=this.sizeObserverUnsubscribeFns;e<t.length;e++){(0,t[e])()}this.sizeObserverUnsubscribeFns=[],null!==this.popper&&(this.popper.destroy(),this.popper=null)},StickToDirective.Observe=function(e){return null===d.Observer&&(d.Observer=new MutationObserver((function(){for(var e=0,t=d.ObserverListeners;e<t.length;e++){(0,t[e])()}})),d.Observer.observe(window.document.documentElement,{childList:!0,attributes:!1,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1})),d.ObserverListeners.push(e),function(){var t=d.ObserverListeners.indexOf(e);t>-1&&(d.ObserverListeners.splice(t,1),d.ObserverListeners.length||(null!==d.Observer&&d.Observer.disconnect(),d.Observer=null))}},StickToDirective.Observer=null,StickToDirective.ObserverListeners=[],StickToDirective=d=e.__decorate([b.Directive("bt-stick-to")],StickToDirective)}();exports.StickToDirective=d;
