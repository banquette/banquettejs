/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../_virtual/_tslib.js"),i=require("@banquette/utils-dom/_cjs/prod/parse-css-duration"),e=require("@banquette/vue-typescript/_cjs/prod/decorator/directive.decorator"),s=function(){function CollapsableDirective(){this.transitioning=!1,this.timerId=null,this.lastKnownAttributes={targetHeight:0,height:"",position:"",overflow:"",opacity:""},this.transitionDuration=null}return CollapsableDirective.prototype.mounted=function(t,i){this.placeholder=document.createElement(t.tagName),this.placeholder.style.overflow="hidden",this.placeholder.style.height="0px",this.placeholder.style.opacity="0",this.placeholder.style.visibility="hidden",this.updated(t,i)},CollapsableDirective.prototype.updated=function(t,i){var e;this.el=t,this.bindings=i,(null===(e=this.bindings.value)||void 0===e?void 0:e.opened)?this.open():this.close()},CollapsableDirective.prototype.unmounted=function(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.placeholder.remove()},CollapsableDirective.prototype.open=function(){var t=this;if("down"!==this.transitioning&&(!1!==this.transitioning||this.collapsed)){if(null!==this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.transitionDuration=this.parseTransitionDuration(this.el),!this.transitionDuration||this.transitionDuration.heightMs<=0)return this.collapsed=!1,this.transitioning=!1,void this.restoreState(this.el);var i=this.transitioning,e="";i||(this.el.parentNode instanceof HTMLElement&&(e=this.el.parentNode.style.position,this.el.parentNode.style.position="relative"),this.el.parentNode.insertBefore(this.placeholder,this.el),this.el.style.position="absolute",this.el.style.opacity="0",this.transitionDuration&&(this.el.style.transitionDuration=this.transitionDuration.pattern.replace("{d}","0.001s"))),this.transitioning="down",i||(this.el.style.height=this.lastKnownAttributes.height,this.el.style.overflow=this.lastKnownAttributes.overflow),this.timerId=window.setTimeout((function(){var s=t.lastKnownAttributes.targetHeight;i||(s=t.measureContentHeight(),t.el.parentNode instanceof HTMLElement&&(t.el.parentNode.style.position=e),t.placeholder.remove(),t.el.style.height="0px",t.el.style.overflow="hidden",t.el.style.position=t.lastKnownAttributes.position,t.el.style.opacity=t.lastKnownAttributes.opacity),t.timerId=window.setTimeout((function(){t.transitionDuration&&(t.el.style.transitionDuration=t.transitionDuration.originalValue),t.timerId=window.setTimeout((function(){var i;t.el.style.height=s+"px",t.timerId=window.setTimeout((function(){t.restoreState(t.el),t.collapsed=!1,t.timerId=null,t.transitioning=!1,t.el.dispatchEvent(new CustomEvent("collapsable-change",{detail:!0}))}),(null===(i=t.transitionDuration)||void 0===i?void 0:i.heightMs)||0)}),50)}))}))}},CollapsableDirective.prototype.close=function(){var t=this;"up"===this.transitioning||!1===this.transitioning&&this.collapsed||(null!==this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.transitioning||(this.saveState(this.el),this.lastKnownAttributes.targetHeight=this.measureContentHeight(),this.el.style.height=this.lastKnownAttributes.targetHeight+"px"),this.transitioning="up",this.el.style.overflow="hidden",this.timerId=window.setTimeout((function(){var i;t.el.style.height="0px",t.timerId=window.setTimeout((function(){t.collapsed=!0,t.timerId=null,t.transitioning=!1,t.el.dispatchEvent(new CustomEvent("collapsable-change",{detail:!1}))}),(null===(i=t.transitionDuration)||void 0===i?void 0:i.heightMs)||0)}),50))},CollapsableDirective.prototype.measureContentHeight=function(){return this.el?this.el.getBoundingClientRect().height:0},CollapsableDirective.prototype.parseTransitionDuration=function(t){for(var e=getComputedStyle(t),s=e.transitionProperty.split(","),n=s.length;--n>=0&&"height"!==s[n]&&"all"!==s[n];);if(n<s.length){var o=e.transitionDuration.split(",");if(o.length>n){var l=o[n];return o[n]="{d}",{originalValue:e.transitionDuration,heightRaw:l,heightMs:i.parseCssDuration(l),pattern:o.join(",")}}}return null},CollapsableDirective.prototype.saveState=function(t){this.lastKnownAttributes.height=t.style.height,this.lastKnownAttributes.overflow=t.style.overflow,this.lastKnownAttributes.position=t.style.position,this.lastKnownAttributes.opacity=t.style.opacity},CollapsableDirective.prototype.restoreState=function(t){t.style.height=this.lastKnownAttributes.height,t.style.overflow=this.lastKnownAttributes.overflow,t.style.position=this.lastKnownAttributes.position,t.style.opacity=this.lastKnownAttributes.opacity},CollapsableDirective=t.__decorate([e.Directive("bt-collapsable")],CollapsableDirective)}();exports.CollapsableDirective=s;
