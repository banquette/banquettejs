/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";var e=require("../_virtual/_tslib.js"),t=require("@banquette/http/_cjs/prod/constants"),o=require("@banquette/ui/_cjs/prod/tree/headless-tree.view-model"),r=require("@banquette/utils-array/_cjs/prod/ensure-in-enum"),n=require("@banquette/utils-type/_cjs/prod/is-array"),a=require("@banquette/utils-type/_cjs/prod/is-object"),i=require("@banquette/vue-material-icons/_cjs/prod/arrow-drop-down"),d=require("@banquette/vue-material-icons/_cjs/prod/help"),s=require("@banquette/vue-typescript/_cjs/prod/decorator/component.decorator"),p=require("@banquette/vue-typescript/_cjs/prod/decorator/expose.decorator"),u=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),m=require("@banquette/vue-typescript/_cjs/prod/decorator/render.decorator"),l=require("@banquette/vue-typescript/_cjs/prod/decorator/themeable.decorator"),c=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),h=require("@banquette/vue-typescript/_cjs/prod/theme/bind-theme.directive"),v=require("@banquette/vue-typescript/_cjs/prod/vue"),_=require("vue");require("../progress/progress-circular/progress-circular.component.vue.js");var y=require("./theme-configuration.js"),b=require("../progress/progress-circular/progress-circular.component.vue_vue_type_script_lang.vue.js"),g=function(v){function TreeComponent(){var e=null!==v&&v.apply(this,arguments)||this;return e.unsubscribeFunctions=[],e}return e.__extends(TreeComponent,v),TreeComponent.prototype.beforeMount=function(){var e=this;this.vm=new o.HeadlessTreeViewModel,this.v=this.vm.viewData,this.vm.setViewData(this.v),this.vm.fetchRemoteNodes(),this.unsubscribeFunctions.push(this.vm.onNodeRemoved((function(t){e.removeFromModelValue(_.toRaw(t.node.originalValue))})))},TreeComponent.prototype.beforeUnmount=function(){for(var e=0,t=this.unsubscribeFunctions;e<t.length;e++){(0,t[e])()}this.unsubscribeFunctions=[]},TreeComponent.prototype.removeFromModelValue=function(e,t){void 0===t&&(t=null),null===t&&(t=this.data);for(var o=0,r=Object.keys(t);o<r.length;o++){var i=r[o];if(_.toRaw(t[i])===e&&n.isArray(t))return t.splice(parseInt(i,10),1),void this.$emit("update:data",this.data);a.isObject(t[i])&&this.removeFromModelValue(e,t[i])}},TreeComponent.prototype.onBasePropsChange=function(){this.vm.nodesIdentifier=this.nodesIdentifier,this.vm.nodesLabel=this.nodesLabel,this.vm.nodesChildren=this.nodesChildren,this.vm.nodesDisabled=this.nodesDisabled,this.vm.remoteNodeUrlParam=this.nodeUrlParam},TreeComponent.prototype.assignLocalData=function(){null!==this.data&&this.vm.synchronize(this.data)},TreeComponent.prototype.syncRemoteConfigurationProps=function(){this.vm.remote.updateConfiguration({model:this.model,url:this.url,method:this.method,endpoint:this.endpoint,urlParams:this.urlParams,headers:this.headers})},TreeComponent.prototype.render=function(e){var t=_.resolveDirective("bt-bind-theme"),o=[];if(this.showRoot)o.push(this.renderNode(e,this.v.root,"node"));else for(var r=0,n=this.v.root.children;r<n.length;r++){var a=n[r];o.push(this.renderNode(e,a))}return _.withDirectives(_.h("div",{class:"bt-tree"},o),[[t]])},TreeComponent.prototype.renderNode=function(e,t,o,r){var n=this;void 0===o&&(o="node"),void 0===r&&(r=0);var a,i=_.resolveDirective("bt-collapsable"),d=[_.renderSlot(e.$slots,o,{node:t,toggle:function(){return n.vm.toggleNode(t)},expand:function(){return n.vm.expandNode(t)},collapse:function(){return n.vm.collapseNode(t)},remove:function(){return n.vm.removeNode(t)}},(function(){return[t.label||"(missing label)"]}))];a=t.remotePending?_.h(_.resolveComponent("bt-progress-circular")):t.fetched?_.h(_.resolveComponent("i-material-arrow-drop-down"),{crop:!0,width:"0.80em"}):_.h("div",{class:"unknown-text"},"?"),d.unshift(_.h("div",{class:"addon"},a));for(var s=_.h("div",{class:"title",style:{paddingLeft:this.indent*r+"px"},onClick:function(e){e.stopPropagation(),n.vm.toggleNode(t)}},d),p=[],u=0,m=t.children;u<m.length;u++){var l=m[u];p.push(this.renderNode(e,l,"node",r+1))}var c=_.withDirectives(_.h("div",{class:"items-wrapper"},p),[[i,{opened:t.expanded}]]);return _.h("div",{class:"bt-tree-item","data-is-expanded":t.expanded?"":null,"data-is-empty":t.fetched&&!t.childrenVisibleCount?"":null,"data-is-disabled":t.disabled?"":null},[s,c])},e.__decorate([u.Prop({type:Array,default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"data",void 0),e.__decorate([u.Prop({type:[String,Function],default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"nodesIdentifier",void 0),e.__decorate([u.Prop({type:[String,Function],default:"label"}),e.__metadata("design:type",Object)],TreeComponent.prototype,"nodesLabel",void 0),e.__decorate([u.Prop({type:[String,Function],default:"children"}),e.__metadata("design:type",Object)],TreeComponent.prototype,"nodesChildren",void 0),e.__decorate([u.Prop({type:[String,Function],default:"disabled"}),e.__metadata("design:type",Object)],TreeComponent.prototype,"nodesDisabled",void 0),e.__decorate([u.Prop({name:"remoteModel",type:String,default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"model",void 0),e.__decorate([u.Prop({name:"remoteUrl",type:String,default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"url",void 0),e.__decorate([u.Prop({name:"remoteEndpoint",type:String,default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"endpoint",void 0),e.__decorate([u.Prop({name:"remoteMethod",type:String,default:t.HttpMethod.GET,transform:function(e){return r.ensureInEnum(e,t.HttpMethod,t.HttpMethod.GET)}}),e.__metadata("design:type",String)],TreeComponent.prototype,"method",void 0),e.__decorate([u.Prop({name:"remoteUrlParams",type:Object,default:{}}),e.__metadata("design:type",Object)],TreeComponent.prototype,"urlParams",void 0),e.__decorate([u.Prop({name:"remoteHeaders",type:Object,default:{}}),e.__metadata("design:type",Object)],TreeComponent.prototype,"headers",void 0),e.__decorate([u.Prop({name:"remoteNodeUrlParam",type:String,default:null}),e.__metadata("design:type",Object)],TreeComponent.prototype,"nodeUrlParam",void 0),e.__decorate([u.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],TreeComponent.prototype,"showRoot",void 0),e.__decorate([u.Prop({type:Number,default:18}),e.__metadata("design:type",Number)],TreeComponent.prototype,"indent",void 0),e.__decorate([p.Expose(),e.__metadata("design:type",Object)],TreeComponent.prototype,"v",void 0),e.__decorate([c.Watch(["nodesIdentifier","nodesLabel","nodesChildren","nodesDisabled","nodeUrlParam"],{immediate:c.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],TreeComponent.prototype,"onBasePropsChange",null),e.__decorate([c.Watch("data",{immediate:c.ImmediateStrategy.BeforeMount,deep:!0}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],TreeComponent.prototype,"assignLocalData",null),e.__decorate([c.Watch(["model","url","endpoint","method","urlParams","headers"],{immediate:c.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],TreeComponent.prototype,"syncRemoteConfigurationProps",null),e.__decorate([m.Render(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Object]),e.__metadata("design:returntype",void 0)],TreeComponent.prototype,"render",null),TreeComponent=e.__decorate([l.Themeable(y.ThemeConfiguration),s.Component({name:"bt-tree",components:[b,i.IconMaterialArrowDropDown,d.IconMaterialHelp],directives:[h.BindThemeDirective],emits:["update:data"]})],TreeComponent)}(v.Vue);module.exports=g;
