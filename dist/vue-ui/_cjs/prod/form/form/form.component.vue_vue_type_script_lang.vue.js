/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";var e=require("../../_virtual/_tslib.js"),t=require("@banquette/form/_cjs/prod/constant"),o=require("@banquette/http/_cjs/prod/constants"),r=require("@banquette/http/_cjs/prod/encoder/form-data.encoder"),n=require("@banquette/http/_cjs/prod/encoder/json.encoder"),a=require("@banquette/http/_cjs/prod/encoder/raw.encoder"),i=require("@banquette/ui/_cjs/prod/form/form/event/after-remote-persist.event-arg"),s=require("@banquette/ui/_cjs/prod/form/form/headless-form-view.model"),p=require("@banquette/utils-array/_cjs/prod/ensure-in-enum"),d=require("@banquette/utils-misc/_cjs/prod/are-equal"),m=require("@banquette/utils-misc/_cjs/prod/make-reassignable"),u=require("@banquette/utils-misc/_cjs/prod/once-per-cycle-proxy"),c=require("@banquette/utils-type/_cjs/prod/ensure-string"),l=require("@banquette/vue-typescript/_cjs/prod/decorator/component.decorator"),y=require("@banquette/vue-typescript/_cjs/prod/decorator/computed.decorator"),f=require("@banquette/vue-typescript/_cjs/prod/decorator/expose.decorator"),_=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),h=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),b=function(b){function FormComponent(){var e,t=null!==b&&b.apply(this,arguments)||this;return t.unsubscribeFunctions=[],t.forceUpdateOnce=u.oncePerCycleProxy((function(){t.forceUpdate()})),t.syncLoadConfigurationProps=(e=!0,function(){t.vm.modelType=t.modelType,t.vm.loadRemote.updateConfiguration({model:t.modelType,url:t.loadUrl,endpoint:t.loadEndpoint,urlParams:t.loadUrlParams,headers:t.loadHeaders}),e&&(e=!1,t.vm.load())}),t}return e.__extends(FormComponent,b),Object.defineProperty(FormComponent.prototype,"visible",{get:function(){return!!this.v&&!(this.v.loading&&this.hasSlot("loading")||this.v.persisting&&this.hasSlot("persisting")||this.v.loadError&&this.hasSlot("load-error")||this.v.persistError&&this.hasSlot("persist-error")||this.v.persistSuccess&&this.hasSlot("persist-success"))},enumerable:!1,configurable:!0}),Object.defineProperty(FormComponent.prototype,"isDisabled",{get:function(){return this.disabled},set:function(e){this.$emit("update:disabled",e)},enumerable:!1,configurable:!0}),FormComponent.prototype.beforeMount=function(){var e=this;this.vm=new s.HeadlessFormViewModel,this.vm.viewData.persistResponse=null,this.vm.loadData=this.modelValue,this.v=this.vm.viewData,this.vm.setViewData(this.v),this.unsubscribeFunctions.push(this.vm.form.onControlAdded(this.forceUpdateOnce,0,!1)),this.unsubscribeFunctions.push(this.vm.form.onControlRemoved(this.forceUpdateOnce,0,!1)),this.unsubscribeFunctions.push(this.vm.form.onValueChanged((function(t){e.$emit("change",t),e.$emit("update:modelValue",e.modelType?e.vm.modelInstance:t.newValue),e.forceUpdateOnce()}))),this.unsubscribeFunctions.push(this.vm.form.onStateChanged((function(o){o.state===t.ContextualizedState.Disabled&&e.$emit("update:disabled",o.newValue)}))),this.unsubscribeFunctions.push(this.vm.onBeforeLoad((function(t){e.$emit("before-load",t),e.onBeforeLoad(t)}))),this.unsubscribeFunctions.push(this.vm.onLoadSuccess((function(t){e.$emit("load-success",t),e.onLoadSuccess(t)}))),this.unsubscribeFunctions.push(this.vm.onLoadError((function(t){e.$emit("load-error",t),e.onLoadError(t)}))),this.unsubscribeFunctions.push(this.vm.onBeforePersist((function(t){e.$emit("before-persist",t),e.onBeforePersist(t)}))),this.unsubscribeFunctions.push(this.vm.onPersistSuccess((function(t){e.vm.viewData.persistResponse=t instanceof i.AfterRemotePersistEventArg?t.response:null,e.$emit("persist-success",t),e.onPersistSuccess(t)}))),this.unsubscribeFunctions.push(this.vm.onPersistError((function(t){e.$emit("persist-error",t),e.onPersistError(t)}))),this.unsubscribeFunctions.push(this.vm.onBeforeValidate((function(t){e.$emit("before-validate",t),e.onBeforeValidate(t)}))),this.unsubscribeFunctions.push(this.vm.onAfterValidate((function(t){e.$emit("after-validate",t),e.onAfterValidate(t)}))),this.unsubscribeFunctions.push(this.vm.onBeforeBindModel((function(t){e.$emit("before-bind-model",t),e.onBeforeBindModel(t)}))),this.unsubscribeFunctions.push(this.vm.onAfterBindModel((function(t){e.$emit("after-bind-model",t),e.v.model=t.model,m.reassign(t.model,e.v.model),e.onAfterBindModel(t)})))},FormComponent.prototype.beforeUnmount=function(){for(var e=0,t=this.unsubscribeFunctions;e<t.length;e++){(0,t[e])()}this.unsubscribeFunctions=[]},FormComponent.prototype.submit=function(){this.vm.submit()},FormComponent.prototype.onBeforeLoad=function(e){},FormComponent.prototype.onLoadSuccess=function(e){},FormComponent.prototype.onLoadError=function(e){},FormComponent.prototype.onBeforePersist=function(e){},FormComponent.prototype.onPersistSuccess=function(e){},FormComponent.prototype.onPersistError=function(e){},FormComponent.prototype.onBeforeValidate=function(e){},FormComponent.prototype.onAfterValidate=function(e){},FormComponent.prototype.onBeforeBindModel=function(e){},FormComponent.prototype.onAfterBindModel=function(e){},FormComponent.prototype.forceUpdate=function(){this.$forceUpdate()},FormComponent.prototype.onDisableChange=function(e){e?this.vm.form.disable():this.vm.form.enable()},FormComponent.prototype.onValidationGroupChange=function(e){this.vm.form.setValidationGroups(e)},FormComponent.prototype.onModelValueChange=function(e){d.areEqual(this.vm.form.value,e)||this.vm.form.setValue(e)},FormComponent.prototype.syncPersistConfigurationProps=function(){this.vm.modelType=this.modelType,this.vm.persistRemote.updateConfiguration({model:this.modelType,url:this.persistUrl,method:this.persistMethod,endpoint:this.persistEndpoint,urlParams:this.persistUrlParams,headers:this.persistHeaders,payloadType:this.persistPayloadType})},e.__decorate([_.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],FormComponent.prototype,"modelValue",void 0),e.__decorate([_.Prop({name:"model",type:String,default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"modelType",void 0),e.__decorate([_.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],FormComponent.prototype,"disabled",void 0),e.__decorate([_.Prop({type:String,default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"loadUrl",void 0),e.__decorate([_.Prop({type:String,default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"loadEndpoint",void 0),e.__decorate([_.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],FormComponent.prototype,"loadUrlParams",void 0),e.__decorate([_.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],FormComponent.prototype,"loadHeaders",void 0),e.__decorate([_.Prop({type:String,default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"persistUrl",void 0),e.__decorate([_.Prop({type:String,transform:function(e){return p.ensureInEnum(c.ensureString(e).toUpperCase(),o.HttpMethod,o.HttpMethod.POST)}}),e.__metadata("design:type",String)],FormComponent.prototype,"persistMethod",void 0),e.__decorate([_.Prop({type:String,default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"persistEndpoint",void 0),e.__decorate([_.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],FormComponent.prototype,"persistUrlParams",void 0),e.__decorate([_.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],FormComponent.prototype,"persistHeaders",void 0),e.__decorate([_.Prop({type:String,transform:function(e){return"form-data"===e?r.PayloadTypeFormData:"raw"===e?a.PayloadTypeRaw:n.PayloadTypeJson}}),e.__metadata("design:type","function"==typeof Symbol?Symbol:Object)],FormComponent.prototype,"persistPayloadType",void 0),e.__decorate([_.Prop({type:Boolean,default:!1}),e.__metadata("design:type",Boolean)],FormComponent.prototype,"submitWithEnter",void 0),e.__decorate([_.Prop({type:[String,Array],default:null}),e.__metadata("design:type",Object)],FormComponent.prototype,"validationGroup",void 0),e.__decorate([y.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],FormComponent.prototype,"visible",null),e.__decorate([y.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[Boolean])],FormComponent.prototype,"isDisabled",null),e.__decorate([f.Expose(),e.__metadata("design:type",Object)],FormComponent.prototype,"v",void 0),e.__decorate([f.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],FormComponent.prototype,"submit",null),e.__decorate([h.Watch("disabled",{immediate:!1}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Boolean]),e.__metadata("design:returntype",void 0)],FormComponent.prototype,"onDisableChange",null),e.__decorate([h.Watch("validationGroup",{immediate:h.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Object]),e.__metadata("design:returntype",void 0)],FormComponent.prototype,"onValidationGroupChange",null),e.__decorate([h.Watch("modelValue",{immediate:!1,deep:!0}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Object]),e.__metadata("design:returntype",void 0)],FormComponent.prototype,"onModelValueChange",null),e.__decorate([h.Watch(["modelType","loadUrl","loadEndpoint","loadUrlParams","loadHeaders"],{immediate:h.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Object)],FormComponent.prototype,"syncLoadConfigurationProps",void 0),e.__decorate([h.Watch(["modelType","persistUrl","persistEndpoint","persistUrlParams","persistHeaders","persistPayloadType"],{immediate:h.ImmediateStrategy.BeforeMount}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],FormComponent.prototype,"syncPersistConfigurationProps",null),FormComponent=e.__decorate([l.Component({name:"bt-form",emits:["change","before-load","load-success","load-error","before-persist","persist-success","persist-error","before-validate","after-validate","before-bind-model","after-bind-model","update:modelValue","update:disabled"]})],FormComponent)}(require("@banquette/vue-typescript/_cjs/prod/vue").Vue);module.exports=b;
