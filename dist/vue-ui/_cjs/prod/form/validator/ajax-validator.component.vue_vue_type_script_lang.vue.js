/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";var e=require("../../_virtual/_tslib.js"),t=require("@banquette/api/_cjs/prod/api-endpoint"),a=require("@banquette/api/_cjs/prod/api-endpoint-storage.service"),o=require("@banquette/dependency-injection/_cjs/prod/decorator/inject.decorator"),r=require("@banquette/dependency-injection/_cjs/prod/decorator/module.decorator"),n=require("@banquette/dependency-injection/_cjs/prod/injector"),i=require("@banquette/exception/_cjs/prod/usage.exception"),p=require("@banquette/http/_cjs/prod/constants"),d=require("@banquette/http/_cjs/prod/http-request.factory"),u=require("@banquette/utils-array/_cjs/prod/ensure-in-enum"),s=require("@banquette/utils-misc/_cjs/prod/proxy"),l=require("@banquette/utils-type/_cjs/prod/is-object"),c=require("@banquette/validation/_cjs/prod/type/ajax"),m=require("@banquette/vue-typescript/_cjs/prod/decorator/component.decorator"),y=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),h=function(h){function ValidateAjaxComponent(e){var t=h.call(this)||this;return t.api=e,t}var j;return e.__extends(ValidateAjaxComponent,h),j=ValidateAjaxComponent,ValidateAjaxComponent.prototype.buildValidator=function(){var e=null;if(this.endpoint?e=this.api.getEndpoint(this.endpoint):this.url&&(e=new t.ApiEndpoint({url:this.url,method:this.method})),!e)throw new i.UsageException("You must define an endpoint or a url to call.");return c.Ajax(d.HttpRequestFactory.Create({url:e.url,method:e.method,params:this.urlParams,payload:c.AutoPayloadSymbol}),s.proxy(this.handleResponse,this),{message:this.message,type:this.type,tags:this.tags,groups:this.groups})},ValidateAjaxComponent.prototype.handleResponse=function(e,t){if(!e.isCanceled){var a=200===e.httpStatusCode||202===e.httpStatusCode;this.responseProperty&&(a=l.isObject(e.result)&&!!e.result[this.responseProperty]),a||t.addViolation(this.type||"ajax",this.message)}},e.__decorate([y.Prop({type:String,default:null}),e.__metadata("design:type",Object)],ValidateAjaxComponent.prototype,"url",void 0),e.__decorate([y.Prop({type:String,default:null}),e.__metadata("design:type",Object)],ValidateAjaxComponent.prototype,"endpoint",void 0),e.__decorate([y.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],ValidateAjaxComponent.prototype,"urlParams",void 0),e.__decorate([y.Prop({type:String,transform:function(e){return u.ensureInEnum(e,p.HttpMethod,p.HttpMethod.POST)}}),e.__metadata("design:type",String)],ValidateAjaxComponent.prototype,"method",void 0),e.__decorate([y.Prop({type:String,default:null}),e.__metadata("design:type",Object)],ValidateAjaxComponent.prototype,"responseProperty",void 0),ValidateAjaxComponent=j=e.__decorate([r.Module(),m.Component({name:"bt-validate-ajax",template:!1,factory:function(){return n.Injector.Get(j)}}),e.__param(0,o.Inject(a.ApiEndpointStorageService)),e.__metadata("design:paramtypes",[a.ApiEndpointStorageService])],ValidateAjaxComponent)}(require("./validator.component.js").ValidatorComponent);module.exports=h;
