/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../_virtual/_tslib.js"),e=require("@banquette/utils-array/_cjs/prod/trim-array"),r=require("@banquette/utils-misc/_cjs/prod/proxy"),a=require("@banquette/utils-type/_cjs/prod/ensure-array"),o=require("@banquette/utils-type/_cjs/prod/ensure-string"),n=require("@banquette/utils-type/_cjs/prod/is-array"),i=require("@banquette/utils-type/_cjs/prod/is-function"),u=require("@banquette/utils-type/_cjs/prod/is-object"),s=require("@banquette/utils-type/_cjs/prod/is-type"),p=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),d=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),l=require("@banquette/vue-typescript/_cjs/prod/utils/converters"),m=require("@banquette/vue-typescript/_cjs/prod/vue"),y=require("../abstract-vue-form.component.js"),c=function(m){function ValidatorComponent(){var t,e=null!==m&&m.apply(this,arguments)||this;return e.autoDetectedParentFormGroup=null,e.parentValidator=null,e.isMounted=!1,e.assignedTargets=[],e.unsetValidatorCallbacks=[],e.assignToParentValidator=(t=null,function(r){null!==t&&(t(),t=null),t=r.registerChild(e.buildValidator()),r.rebuild(),e.unsetValidatorCallbacks.push((function(){null!==t&&(t(),t=null),r.rebuild()}))}),e}return t.__extends(ValidatorComponent,m),Object.defineProperty(ValidatorComponent.prototype,"message",{get:function(){if(this.hasSlot("default")){var t=this.getVNodesText(this.$slots.default());if(t.length>0)return t}return this.messageProp},enumerable:!1,configurable:!0}),Object.defineProperty(ValidatorComponent.prototype,"parentFormGroup",{get:function(){return null!==this.form?this.form:this.autoDetectedParentFormGroup},enumerable:!1,configurable:!0}),ValidatorComponent.prototype.mounted=function(){this.isMounted=!0,this.rebuild();var t=this.getParent("bt-form");if(t&&this.isFormGroupInterface(t.vm.form)){var e=t.vm.form;this.autoDetectedParentFormGroup=e,e.onControlAdded(r.proxy(this.updateFromTargets,this),0,!1)}this.updateFromTargets()},ValidatorComponent.prototype.unmounted=function(){for(var t=0,e=this.unsetValidatorCallbacks;t<e.length;t++){(0,e[t])()}this.unsetValidatorCallbacks=[]},ValidatorComponent.prototype.rebuild=function(){if(this.isMounted)for(var t=this.$parent;t;){if((t=l.maybeResolveTsInst(t))instanceof y.AbstractVueFormComponent)return t.proxy.setValidator(this.buildValidator());if(s.isType(t,(function(){return i.isFunction(t.registerChild)})))return this.parentValidator=t,this.assignToParentValidator(t);t=t.$parent}},ValidatorComponent.prototype.updateFromTargets=function(){var t=this;if(this.parentFormGroup){for(var e=[],_loop_1=function(a){r.parentFormGroup.getByPattern(a).forEach((function(r){t.assignedTargets.indexOf(a)<0&&(r.setValidator(t.buildValidator()),t.unsetValidatorCallbacks.push((function(){r.setValidator(null)}))),e.push(a)}))},r=this,a=0,o=this.targetsPaths;a<o.length;a++){_loop_1(o[a])}this.assignedTargets=e}},ValidatorComponent.prototype.isFormGroupInterface=function(t){return u.isObject(t)&&"get"in t&&"getByPath"in t&&"getByPattern"in t},t.__decorate([p.Prop({type:Object,default:null}),t.__metadata("design:type",Object)],ValidatorComponent.prototype,"form",void 0),t.__decorate([p.Prop({name:"target",type:[String,Array],default:[],transform:function(t){return e.trimArray(n.isArray(t)?t:o.ensureString(t).split(",")).filter((function(t){return!!t}))}}),t.__metadata("design:type",Array)],ValidatorComponent.prototype,"targetsPaths",void 0),t.__decorate([p.Prop({name:"message",type:String,default:void 0}),t.__metadata("design:type",String)],ValidatorComponent.prototype,"messageProp",void 0),t.__decorate([p.Prop({type:String,default:void 0}),t.__metadata("design:type",String)],ValidatorComponent.prototype,"type",void 0),t.__decorate([p.Prop({type:[String,Array],default:[],transform:function(t){return a.ensureArray(t)}}),t.__metadata("design:type",Array)],ValidatorComponent.prototype,"tags",void 0),t.__decorate([p.Prop({type:[String,Array],default:[],transform:function(t){return a.ensureArray(t)}}),t.__metadata("design:type",Array)],ValidatorComponent.prototype,"groups",void 0),t.__decorate([d.Watch("target",{immediate:d.ImmediateStrategy.NextTick}),t.__metadata("design:type",Function),t.__metadata("design:paramtypes",[]),t.__metadata("design:returntype",void 0)],ValidatorComponent.prototype,"updateFromTargets",null),ValidatorComponent}(m.Vue);exports.ValidatorComponent=c;
