/*!
 * Banquette VueUi v0.0.0 (CommonJS)
 * (c) 2022-2022 Julien Pinto
 * Released under Apache License, Version 2.0
 */
"use strict";var e=require("../_virtual/_tslib.js"),t=require("@banquette/dependency-injection/_cjs/prod/injector"),o=require("@banquette/exception/_cjs/prod/usage.exception"),r=require("@banquette/ui/_cjs/prod/table/constant"),a=require("@banquette/ui/_cjs/prod/table/table-view-model"),n=require("@banquette/utils-misc/_cjs/prod/throttle"),i=require("@banquette/utils-string/_cjs/prod/format/ltrim"),p=require("@banquette/utils-type/_cjs/prod/ensure-array"),s=require("@banquette/utils-type/_cjs/prod/is-null-or-undefined"),l=require("@banquette/utils-type/_cjs/prod/is-object"),u=require("@banquette/utils-type/_cjs/prod/is-undefined"),m=require("@banquette/vue-material-icons/_cjs/prod/report"),d=require("@banquette/vue-typescript/_cjs/prod/decorator/component.decorator"),c=require("@banquette/vue-typescript/_cjs/prod/decorator/computed.decorator"),_=require("@banquette/vue-typescript/_cjs/prod/decorator/expose.decorator"),y=require("@banquette/vue-typescript/_cjs/prod/decorator/import.decorator"),b=require("@banquette/vue-typescript/_cjs/prod/decorator/prop.decorator"),f=require("@banquette/vue-typescript/_cjs/prod/decorator/watch.decorator"),v=require("@banquette/vue-typescript/_cjs/prod/utils/converters"),g=require("@banquette/vue-typescript/_cjs/prod/vue");require("../form/form/form.component.vue.js");var h=require("../misc/remote/remote.composable.js"),q=require("../misc/teleport.directive.js");require("../progress/progress-circular/progress-circular.component.vue.js"),require("./column/column.component.vue.js");var C=require("./composable/filtering.composable.js"),T=require("./composable/ordering.composable.js"),j=require("./composable/pagination.composable.js");require("./filter/filter.component.vue.js"),require("./pagination/pagination.component.vue.js");var F=require("./column/column.component.ts_vue_type_script_src_lang.js"),O=require("./pagination/pagination.component.ts_vue_type_script_src_lang.js"),P=require("./filter/filter.component.ts_vue_type_script_src_lang.js"),U=require("../form/form/form.component.vue_vue_type_script_lang.vue.js"),x=require("../progress/progress-circular/progress-circular.component.vue_vue_type_script_lang.vue.js"),I=function(g){function TableComponent(){var e=null!==g&&g.apply(this,arguments)||this;return e.filtersMap={},e}return e.__extends(TableComponent,g),Object.defineProperty(TableComponent.prototype,"hasActiveFilters",{get:function(){if(u.isUndefined(this.vm)||!this.filterFormReady)return!1;for(var e=0,t=this.vm.visibleColumns;e<t.length;e++){var o=t[e];if(!u.isUndefined(this.filtersMap[o.id]))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(TableComponent.prototype,"filterFormReady",{get:function(){return l.isObject(this.$refs)&&!u.isUndefined(this.$refs.form)},enumerable:!1,configurable:!0}),TableComponent.prototype.beforeMount=function(){this.vm=t.Injector.Get(a.TableViewModel),this.pagination.module=this.vm.pagination,this.filtering.module=this.vm.filtering,this.order.module=this.vm.ordering,this.remote.module=this.vm.remote},TableComponent.prototype.mounted=function(){var e=this;this.$nextTick((function(){setTimeout((function(){e.filteringForm=e.watchFilteringForm(),Object.keys(e.filters).length||e.vm.fetch()})),e.$forceUpdateComputed()})),this.vm.localDispatcher.subscribe(r.TableEvents.UpdateView,n.throttle((function(){e.$forceUpdate()}),50))},TableComponent.prototype.addFilter=function(e,t){this.filtersMap[e]=t},TableComponent.prototype.hasSlot=function(e){return g.prototype.hasSlot.call(this,e)},TableComponent.prototype.syncConfigurationProps=function(){this.vm.id=this.id,this.vm.syncUrl=this.syncUrl,this.vm.saveState=this.saveState},TableComponent.prototype.onItemsChange=function(e){this.vm.items=e},TableComponent.prototype.watchFilteringForm=function(){var e=this,t=v.anyToTsInst(this.$refs.form);if(!t)throw new o.UsageException("Failed to bind filtering form.");var r=t.vm.form,computeChangesAndFetch=function(){for(var t={},o=0,a=Object.keys(e.filters);o<a.length;o++){var n=a[o];t[n]=e.filters[n]}r.getByPattern("**:control:valid").forEach((function(e){var o=i.ltrim(e.path,"/").split("/"),r=o.pop();if(r&&e.valid){for(var a=t,n=0;n<o.length;++n)l.isObject(a[o[n]])||(a[o[n]]={}),a=a[o[n]];s.isNullOrUndefined(e.value)||""===e.value?u.isUndefined(a[r])||delete a[r]:a[r]=e.value}}));for(var m=0,d=Object.keys(t);m<d.length;m++){n=d[m];var c=p.ensureArray(e.filtersNames[n]);if(c.length){var _=t[n];delete t[n];for(var y=0,b=c;y<b.length;y++){var f=b[y];t[f]=_}}}e.vm.filtering.setFilters(t)};return r.setDefaultValue(this.filters),r.reset(),r.onValueChanged(computeChangesAndFetch),computeChangesAndFetch(),r},e.__decorate([b.Prop({default:null,transform:function(e){return p.ensureArray(e)}}),e.__metadata("design:type",Object)],TableComponent.prototype,"items",void 0),e.__decorate([b.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],TableComponent.prototype,"filtersNames",void 0),e.__decorate([b.Prop({type:Object,default:{}}),e.__metadata("design:type",Object)],TableComponent.prototype,"filters",void 0),e.__decorate([b.Prop({type:String,default:null}),e.__metadata("design:type",Object)],TableComponent.prototype,"id",void 0),e.__decorate([b.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],TableComponent.prototype,"syncUrl",void 0),e.__decorate([b.Prop({type:Boolean,default:!0}),e.__metadata("design:type",Boolean)],TableComponent.prototype,"saveState",void 0),e.__decorate([y.Import(j.PaginationComposable),e.__metadata("design:type",j.PaginationComposable)],TableComponent.prototype,"pagination",void 0),e.__decorate([y.Import(C.FilteringComposable,{remote:"filteringRemote",filters:!1}),e.__metadata("design:type",C.FilteringComposable)],TableComponent.prototype,"filtering",void 0),e.__decorate([y.Import(T.OrderingComposable),e.__metadata("design:type",T.OrderingComposable)],TableComponent.prototype,"order",void 0),e.__decorate([y.Import(h.RemoteComposable,!1),e.__metadata("design:type",h.RemoteComposable)],TableComponent.prototype,"remote",void 0),e.__decorate([_.Expose(),e.__metadata("design:type",Object)],TableComponent.prototype,"filtersMap",void 0),e.__decorate([c.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],TableComponent.prototype,"hasActiveFilters",null),e.__decorate([c.Computed(),e.__metadata("design:type",Boolean),e.__metadata("design:paramtypes",[])],TableComponent.prototype,"filterFormReady",null),e.__decorate([_.Expose(),e.__metadata("design:type",a.TableViewModel)],TableComponent.prototype,"vm",void 0),e.__decorate([_.Expose(),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[String]),e.__metadata("design:returntype",Boolean)],TableComponent.prototype,"hasSlot",null),e.__decorate([f.Watch(["id","syncUrl","saveState"],{immediate:f.ImmediateStrategy.NextTick}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[]),e.__metadata("design:returntype",void 0)],TableComponent.prototype,"syncConfigurationProps",null),e.__decorate([f.Watch("items",{immediate:f.ImmediateStrategy.Mounted}),e.__metadata("design:type",Function),e.__metadata("design:paramtypes",[Array]),e.__metadata("design:returntype",void 0)],TableComponent.prototype,"onItemsChange",null),TableComponent=e.__decorate([d.Component({name:"bt-table",components:[F,O,P,q.TeleportDirective,U,m.IconMaterialReport,x]})],TableComponent)}(g.Vue);module.exports=I;
